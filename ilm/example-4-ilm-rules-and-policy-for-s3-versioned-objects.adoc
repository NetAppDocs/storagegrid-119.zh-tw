---
permalink: ilm/example-4-ilm-rules-and-policy-for-s3-versioned-objects.html 
sidebar: sidebar 
keywords: object versions, example ILM rule, information lifecycle rule examples 
summary: 如果您有一個啟用了版本控制的 S3 儲存桶，則可以透過在 ILM 策略中包含使用非目前時間作為參考時間的規則來管理非目前物件版本。 
---
= 範例 4：S3 版本化物件的 ILM 規則和策略
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
如果您有一個啟用了版本控制的 S3 儲存桶，則可以透過在 ILM 策略中包含使用「非目前時間」作為參考時間的規則來管理非目前物件版本。


CAUTION: 如果您為物件指定了有限的保留時間，則達到該時間段後這些物件將會永久刪除。確保您了解物件將被保留多長時間。

如本例所示，您可以透過對非目前物件版本使用不同的放置指令來控製版本化物件使用的儲存量。


CAUTION: 以下 ILM 規則和策略僅作為範例。配置 ILM 規則的方法有很多種。在啟動新策略之前，請先進行模擬以確認它能夠如預期運作以保護內容免於遺失。


NOTE: 若要對物件的非目前版本執行 ILM 策略模擬，您必須知道物件版本的 UUID 或 CBID。若要尋找 UUID 和 CBID，請使用link:verifying-ilm-policy-with-object-metadata-lookup.html["對像元資料查找"]當物件仍處於目前狀態時。

.相關資訊
link:how-objects-are-deleted.html["如何刪除對象"]



== ILM 規則 1 例如 4：保存三份副本，保存 10 年

此範例 ILM 規則將每個物件的副本儲存在三個網站 10 年。

此規則適用於所有對象，無論它們是否已版本化。

[cols="1a,2a"]
|===
| 規則定義 | 範例值 


 a| 
儲存池
 a| 
三個儲存池，每個由不同的資料中心組成，分別名為站點 1、站點 2 和站點 3。



 a| 
規則名稱
 a| 
十年三份



 a| 
參考時間
 a| 
攝取時間



 a| 
展示位置
 a| 
在第 0 天，保留三個副本 10 年（3,652 天），一個在站點 1，一個在站點 2，一個在站點 3。  10 年後，刪除該物件的所有副本。

|===


== ILM 規則 2 例如 4：儲存兩個非目前版本的副本，儲存 2 年

此範例 ILM 規則將儲存 S3 版本物件的非目前版本的兩個副本，儲存期限為 2 年。

由於 ILM 規則 1 適用於物件的所有版本，因此您必須建立另一個規則來過濾掉任何非目前版本。

若要建立使用「非目前時間」作為參考時間的規則，請在建立 ILM 規則精靈的步驟 1（輸入詳細資料）中針對「僅將此規則套用於舊物件版本（在啟用了版本控制的 S3 儲存桶中）？」問題選擇*是*。當您選擇“是”時，將自動選擇“非當前時間”作為參考時間，您不能選擇其他參考時間。

image::../media/ilm-rule-apply-only-to-older-object-verions.png[僅將 ILM 規則套用至較舊的物件版本（非目前時間）]

在此範例中，僅儲存了非目前版本的兩個副本，並且這些副本將儲存兩年。

[cols="1a,2a"]
|===
| 規則定義 | 範例值 


 a| 
儲存池
 a| 
兩個儲存池，分別位於不同的資料中心：站點 1 和站點 2。



 a| 
規則名稱
 a| 
非現行版本：兩年兩份



 a| 
參考時間
 a| 
非當前時間

在建立 ILM 規則精靈中，對於「僅將此規則套用於舊物件版本（在啟用了版本控制的 S3 儲存桶中）？」的問題選擇「是」時，會自動選擇。



 a| 
展示位置
 a| 
在相對於非當前時間的第 0 天（即從物件版本成為非當前版本的那天開始），將非目前物件版本的兩個副本保留 2 年（730 天），一個在站點 1，一個在站點 2。兩年後，刪除非目前版本。

|===


== ILM 策略範例 4：S3 版本化對象

如果您想要以不同於目前版本的方式管理物件的舊版本，則使用「非目前時間」作為參考時間的規則必須出現在 ILM 策略中，並且出現在適用於目前物件版本的規則之前。

S3 版本化物件的 ILM 策略可能包括以下 ILM 規則：

* 從版本變為非當前版本之日起，將每個物件的任何舊版本（非當前版本）保留 2 年。
+

NOTE: 「非目前時間」規則必須出現在策略中適用於目前物件版本的規則之前。否則，非當前物件版本將永遠不會符合「非當前時間」規則。

* 在攝取時，建立三個副本並在三個站點各儲存一份。保留目前物件版本的副本 10 年。


當您模擬範例策略時，您會期望測試物件如下進行評估：

* 任何非目前物件版本都將與第一條規則相符。如果非目前物件版本超過 2 年，它將被 ILM 永久刪除（非目前版本的所有副本都將從網格中刪除）。
* 當前物件版本將與第二條規則相符。當目前物件版本已儲存 10 年後，ILM 流程會新增一個刪除標記作為物件的目前版本，並使先前的物件版本變為「非目前」版本。下次進行 ILM 評估時，此非目前版本將與第一條規則相符。因此，站點 3 的副本被清除，站點 1 和站點 2 的兩個副本將再保存 2 年。

