---
permalink: ilm/creating-ilm-policy.html 
sidebar: sidebar 
keywords: how to create ILM policy 
summary: 建立一個或多個 ILM 策略以滿足您的服務品質要求。 
---
= 建立 ILM 策略
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
建立一個或多個 ILM 策略以滿足您的服務品質要求。

擁有一個活動的 ILM 策略可讓您將相同的 ILM 規則應用於所有租用戶和儲存桶。

擁有多個活動的 ILM 策略可讓您將適當的 ILM 規則應用於特定的租戶和儲存桶，以滿足多種服務品質要求。



== 建立 ILM 策略

.關於此任務
在創建您自己的策略之前，請先驗證link:ilm-policy-overview.html#default-ilm-policy["預設 ILM 策略"]不符合您的儲存要求。


NOTE: 在測試系統中，僅使用系統提供的策略，即 2 個副本策略（適用於單一站點網格）或每個站點 1 個副本（適用於多站點網格）。對於StorageGRID 11.6 及更早版本，此原則中的預設規則使用包含所有網站的所有儲存節點儲存池。如果您的StorageGRID系統有多個站點，則物件的兩個副本可能會放置在同一個站點上。


NOTE: 如果link:enabling-s3-object-lock-globally.html["全域 S3 物件鎖定設定已啟用"]，您必須確保 ILM 策略符合啟用了 S3 物件鎖定的儲存桶的要求。在本節中，請依照提及啟用 S3 物件鎖定的說明進行操作。

.開始之前
* 您已使用link:../admin/web-browser-requirements.html["支援的網頁瀏覽器"]。
* 你有link:../admin/admin-group-permissions.html["所需的存取權限"]。
* 你有link:access-create-ilm-rule-wizard.html["建立 ILM 規則"]根據是否啟用 S3 物件鎖。
+
[role="tabbed-block"]
====
.S3 物件鎖未啟用
--
** 你有link:what-ilm-rule-is.html["建立 ILM 規則"]您想要新增到策略中。根據需要，您可以儲存策略、建立其他規則，然後編輯策略以新增規則。
** 你有link:creating-default-ilm-rule.html["建立了預設的 ILM 規則"]不包含任何過濾器。


--
.已啟用 S3 物件鎖定
--
** 這link:enabling-s3-object-lock-globally.html["全域 S3 物件鎖定設定已啟用"]用於StorageGRID系統。
** 你有link:what-ilm-rule-is.html["創建合規和不合規的 ILM 規則"]您想要新增到策略中。根據需要，您可以儲存策略、建立其他規則，然後編輯策略以新增規則。
** 你有link:creating-default-ilm-rule.html["建立了預設的 ILM 規則"]符合政策。


--
====
* 或者，您已經觀看了影片： https://netapp.hosted.panopto.com/Panopto/Pages/Viewer.aspx?id=e768d4da-da88-413c-bbaa-b1ff00874d10["影片：ILM 政策概述"^]
+
[link=https://netapp.hosted.panopto.com/Panopto/Pages/Viewer.aspx?id=e768d4da-da88-413c-bbaa-b1ff00874d10]
image::../media/video-screenshot-ilm-policies-118.png[影片：ILM 政策概述]



另請參閱link:ilm-policy-overview.html["使用 ILM 策略"] 。

.步驟
. 選擇 *ILM* > *策略*。
+
如果啟用了全域 S3 物件鎖定設置，則 ILM 原則頁面會指示哪些 ILM 規則是符合規定的。

. 確定您想要如何建立 ILM 策略。
+
[role="tabbed-block"]
====
.建立新策略
--
.. 選擇*建立策略*。


--
.克隆現有策略
--
.. 選取您想要開始的策略的複選框，然後選擇*克隆*。


--
.編輯現有政策
.. 如果策略處於非活動狀態，您可以對其進行編輯。選取您想要開始的非活動策略的複選框，然後選擇*編輯*。


====


. 在「策略名稱」欄位中，輸入策略的唯一名稱。
. 或者，在*變更原因*欄位中，輸入建立新策略的原因。
. 若要為策略新增規則，請選擇「選擇規則」。選擇規則名稱以查看該規則的設定。
+
--
如果您正在克隆策略：

** 您正在複製的策略所使用的規則已被選取。
** 如果您複製的策略使用了任何不帶過濾器的非預設規則的規則，系統將提示您刪除除其中一條規則之外的所有規則。
** 如果預設規則使用了篩選器，系統會提示您選擇新的預設規則。
** 如果預設規則不是最後一條規則，您可以將該規則移至新政策的末端。


--
+
[role="tabbed-block"]
====
.S3 物件鎖未啟用
--
.. 為策略選擇一個預設規則。若要建立新的預設規則，請選擇*ILM 規則頁面*。
+
預設規則適用於與策略中其他規則不符的任何物件。預設規則不能使用任何過濾器，並且始終最後進行評估。

+

NOTE: 不要將「製作 2 份副本」規則用作策略的預設規則。 Make 2 Copies 規則使用單一儲存池，即包含所有網站的所有儲存節點。如果您的StorageGRID系統有多個站點，則物件的兩個副本可能會放置在同一個站點上。



--
.已啟用 S3 物件鎖定
--
.. 為策略選擇一個預設規則。若要建立新的預設規則，請選擇*ILM 規則頁面*。
+
規則清單僅包含符合要求且不使用任何篩選器的規則。

+

NOTE: 不要將「製作 2 份副本」規則用作策略的預設規則。 Make 2 Copies 規則使用單一儲存池，即包含所有網站的所有儲存節點。如果使用此規則，則物件的多個副本可能會放置在同一個網站上。

.. 如果您需要針對不合規 S3 儲存桶中的物件使用不同的「預設」規則，請選擇*包含不合規 S3 儲存桶的無篩選器規則*，然後選擇一個不使用篩選器的不合規規則。
+
例如，您可能想要使用雲端儲存池將物件儲存在未啟用 S3 物件鎖定的儲存桶中。

+

NOTE: 您只能選擇一個不使用篩選器的不合規規則。



另請參閱link:example-7-compliant-ilm-policy-for-s3-object-lock.html["範例 7：符合 S3 物件鎖定的 ILM 策略"] 。

--
====


. 選擇完預設規則後，選擇「繼續」。
. 對於其他規則步驟，選擇要新增至策略的任何其他規則。這些規則至少使用一個篩選器（租用戶帳戶、儲存桶名稱、進階篩選器或非目前參考時間）。然後選擇*選擇*。
+
現在，「建立策略」視窗列出了您選擇的規則。預設規則位於最後，其他規則位於其上方。

+
如果啟用了 S3 物件鎖定並且您也選擇了不合規的「預設」規則，則該規則將作為策略中的倒數第二個規則新增。

+

NOTE: 如果任何規則沒有永久保留對象，則會出現警告。啟動此策略時，您必須確認希望StorageGRID在預設規則的放置指令過期時刪除物件（除非儲存桶生命週期將物件保留更長時間）。

. 拖曳非預設規則的行來決定這些規則的評估順序。
+
您不能移動預設規則。如果啟用了 S3 物件鎖定，您也無法移動不合規的「預設」規則（如果選擇了該規則）。

+

NOTE: 您必須確認 ILM 規則的順序正確。當策略被啟動時，新的和現有的物件將按照列出的順序從頂部開始由規則進行評估。

. 根據需要，選擇*選擇規則*來新增或刪除規則。
. 完成後，選擇*儲存*。
. 重複這些步驟來建立其他 ILM 策略。
. <<simulate-ilm-policy,模擬 ILM 策略>> 。您應該始終在激活策略之前對其進行模擬，以確保其按預期工作。




== 模擬策略

在啟動策略並將其應用於生產資料之前，先在測試物件上模擬該策略。

.開始之前
* 您知道要測試的每個物件的 S3 儲存桶/物件鍵。


.步驟
. 使用 S3 客戶端或link:../tenant/use-s3-console.html["S3 控制台"]，攝取測試每條規則所需的物件。
. 在 ILM 策略頁面上，選取該策略的複選框，然後選擇*模擬*。
. 在「物件」欄位中，輸入 S3 `bucket/object-key`用於測試對象。例如，  `bucket-01/filename.png` 。
. 如果啟用了 S3 版本控制，則可以選擇在 *版本 ID* 欄位中輸入物件的版本 ID。
. 選擇*模擬*。
. 在模擬結果部分，確認每個物件都符合正確的規則。
. 若要確定哪個儲存池或擦除編碼設定檔有效，請選擇符合規則的名稱以前往規則詳細資料頁面。



CAUTION: 審查現有複製和擦除編碼物件的位置的任何變更。在評估和實施新位置時，更改現有物件的位置可能會導致臨時資源問題。

.結果
對策略規則的任何編輯都將反映在模擬結果中，並顯示新的匹配和先前的匹配。模擬策略視窗將保留您測試的對象，直到您選擇“全部清除”或“刪除”圖標image:../media/icon-x-to-remove.png["刪除圖示"]對於模擬結果清單中的每個物件。

.相關資訊
link:simulating-ilm-policy-examples.html["ILM 策略模擬範例"]



== 啟動策略

當您啟動單一新的 ILM 策略時，現有物件和新接收的物件都由該策略管理。當您啟動多個策略時，指派給儲存桶的 ILM 策略標籤決定了要管理的物件。

在啟動新策略之前：

. 模擬該策略以確認其行為符合您的預期。
. 審查現有複製和擦除編碼物件的位置的任何變更。在評估和實施新位置時，更改現有物件的位置可能會導致臨時資源問題。



CAUTION: ILM 策略中的錯誤可能會導致無法復原的資料遺失。

.關於此任務
當您啟動 ILM 策略時，系統會將新策略分發到所有節點。但是，直到所有網格節點都可以接收新策略時，新的活動策略才可能真正生效。在某些情況下，系統會等待實施新的活動策略，以確保網格物件不會被意外刪除。具體來說：

* 如果您所做的策略變更*增加了資料冗餘或持久性*，則這些變更將立即實施。例如，如果您啟動包含三份副本規則而不是兩份副本規則的新策略，則該策略將立即實施，因為它增加了資料冗餘。
* 如果您所做的策略變更*可能會降低資料冗餘度或持久性*，則這些變更將不會實施，直到所有網格節點都可用。例如，如果您啟動使用兩份規則而不是三份規則的新策略，則新策略將出現在「活動策略」標籤中，但直到所有節點都聯機且可用時才會生效。


.步驟
請依照以下步驟啟動一個或多個策略：

[role="tabbed-block"]
====
.啟動一項策略
--
如果您只有一項有效政策，請依照下列步驟操作。如果您已經擁有一個或多個有效策略，並且要啟動其他策略，請按照啟動多個策略的步驟操作。

. 當您準備好啟動策略時，選擇 *ILM* > *Policies*。
+
或者，您可以從 *ILM* > *策略標籤* 頁面啟動單一策略。

. 在「策略」標籤上，選取要啟動的策略的複選框，然後選擇「*啟動*」。
. 請按照適當的步驟操作：
+
** 如果警告訊息提示您確認是否要啟動該策略，請選擇「*確定*」。
** 如果出現包含有關該策略的詳細資訊的警告訊息：
+
... 檢查詳細資訊以確保策略能夠按預期管理資料。
... 如果預設規則儲存物件的天數有限，請查看保留圖，然後在文字方塊中輸入該天數。
... 如果預設規則永久儲存對象，但一個或多個其他規則具有有限的保留，請在文字方塊中輸入 *yes*。
... 選擇*啟動策略*。






--
.啟動多項策略
--
要啟動多個策略，您必須建立標籤並為每個標籤指派一個策略。


TIP: 當使用多個標籤時，如果租戶頻繁地將策略標籤重新指派給儲存桶，則網格效能可能會受到影響。如果您有不受信任的租戶，請考慮僅使用預設標籤。

. 選擇 *ILM* > *策略標籤*。
. 選擇“*創建*”。
. 在建立策略標籤對話方塊中，鍵入標籤名稱，並選擇性地鍵入標籤描述。
+

NOTE: 標籤名稱和描述對租戶可見。選擇能夠幫助租戶在選擇分配給其儲存桶的策略標籤時做出明智決定的值。例如，如果指派的策略將在一段時間後刪除對象，您可以在描述中傳達這一點。不要在這些欄位中包含敏感資訊。

. 選擇*建立標籤*。
. 在 ILM 策略標籤表中，使用下拉式選單選擇要指派給標籤的策略。
. 如果「政策限制」欄位中出現警告，請選擇「查看政策詳情」以查看該政策。
. 確保每項策略都能如預期管理資料。
. 選擇*啟動分配的策略*。或者，選擇“*清除變更*”以刪除策略分配。
. 在使用新標籤啟動策略對話方塊中，查看每個標籤、策略和規則如何管理物件的描述。根據需要進行更改以確保策略能夠按預期管理對象。
. 當您確定要啟動策略時，在文字方塊中輸入*yes*，然後選擇*Activate policies*。


--
====
.相關資訊
link:example-6-changing-ilm-policy.html["範例 6：更改 ILM 策略"]
