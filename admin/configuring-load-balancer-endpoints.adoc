---
permalink: admin/configuring-load-balancer-endpoints.html 
sidebar: sidebar 
keywords: how to configure load balancer endpoint, how to attach certificate to load balancer endpoint 
summary: 負載平衡器端點決定 S3 用戶端在連接到網關和管理節點上的StorageGRID負載平衡器時可以使用的連接埠和網路協定。您也可以使用端點存取網格管理員、租用戶管理器或兩者。 
---
= 配置負載平衡器端點
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
負載平衡器端點決定 S3 用戶端在連接到網關和管理節點上的StorageGRID負載平衡器時可以使用的連接埠和網路協定。您也可以使用端點存取網格管理員、租用戶管理器或兩者。


TIP: 此版本的文件網站已刪除 Swift 詳細資訊。看 https://docs.netapp.com/us-en/storagegrid-118/admin/configuring-client-connections.html["配置 S3 和 Swift 用戶端連接"^]。

.開始之前
* 您已使用link:../admin/web-browser-requirements.html["支援的網頁瀏覽器"]。
* 你有link:admin-group-permissions.html["Root存取權限"]。
* 您已審閱link:managing-load-balancing.html["負載平衡的注意事項"]。
* 如果您之前重新映射了要用於負載平衡器端點的端口，則您必須link:../maintain/removing-port-remaps.html["刪除了連接埠重新映射"]。
* 您已建立計劃使用的任何高可用性 (HA) 群組。建議使用 HA 組，但這不是必需的。看link:managing-high-availability-groups.html["管理高可用性組"] 。
* 如果負載平衡器端點將由link:../admin/manage-s3-select-for-tenant-accounts.html["S3 Select 的 S3 租戶"]，它不能使用任何裸機節點的 IP 位址或 FQDN。僅允許服務設備和基於 VMware 的軟體節點作為用於 S3 Select 的負載平衡器端點。
* 您已設定計劃使用的所有 VLAN 介面。看link:configure-vlan-interfaces.html["配置VLAN介面"] 。
* 如果您正在建立 HTTPS 端點（建議），則您擁有伺服器憑證的資訊。
+

NOTE: 端點憑證的變更可能需要長達 15 分鐘才能套用到所有節點。

+
** 要上傳證書，您需要伺服器證書、證書私鑰以及可選的 CA 套件。
** 要產生證書，您需要 S3 用戶端將用於存取端點的所有網域名稱和 IP 位址。您還必須知道主題（專有名稱）。
** 如果您想使用StorageGRID S3 API 憑證（也可用於直接連接到儲存節點），您已經用外部憑證授權單位簽署的自訂憑證取代了預設憑證。看link:../admin/configuring-custom-server-certificate-for-storage-node.html["配置 S3 API 證書"] 。






== 建立負載平衡器端點

每個 S3 用戶端負載平衡器端點指定一個連接埠、一個客戶端類型（S3）和一個網路協定（HTTP 或 HTTPS）。管理介面負載平衡器端點指定連接埠、介面類型和不受信任的客戶端網路。



=== 訪問嚮導

.步驟
. 選擇 *配置* > *網路* > *負載平衡器端點*。
. 若要為 S3 或 Swift 用戶端建立端點，請選擇 *S3 或 Swift 用戶端* 標籤。
. 若要建立用於存取網格管理器、租用戶管理員或兩者的端點，請選擇「管理介面」標籤。
. 選擇“*創建*”。




=== 輸入端點詳細信息

.步驟
. 選擇適當的說明來輸入您想要建立的端點類型的詳細資訊。


[role="tabbed-block"]
====
.S3 或 Swift 用戶端
--
[cols="1a,3a"]
|===
| 場地 | 描述 


 a| 
Name
 a| 
端點的描述性名稱，將顯示在負載平衡器端點頁面的表格中。



 a| 
港口
 a| 
您想要用於負載平衡的StorageGRID連接埠。對於您建立的第一個端點，此欄位預設為 10433，但您可以輸入 1 到 65535 之間的任何未使用的外部連接埠。

如果您輸入 *80* 或 *8443*，則端點僅在網關節點上配置，除非您釋放了連接埠 8443。然後，您可以使用連接埠 8443 作為 S3 端點，並且該連接埠將在網關和管理節點上進行設定。



 a| 
客戶端類型
 a| 
將使用此端點的客戶端應用程式的類型，*S3* 或 *Swift*。



 a| 
網路協定
 a| 
用戶端連接到此端點時將使用的網路協定。

* 選擇 *HTTPS* 進行安全的 TLS 加密通訊（建議）。您必須先附加安全性證書，然後才能儲存端點。
* 選擇 *HTTP* 進行安全性較低、未加密的通訊。僅對非生產網格使用 HTTP。


|===
--
.管理介面
--
[cols="1a,3a"]
|===
| 場地 | 描述 


 a| 
Name
 a| 
端點的描述性名稱，將顯示在負載平衡器端點頁面的表格中。



 a| 
港口
 a| 
您要用於存取網格管理器、租用戶管理器或兩者的StorageGRID連接埠。

* 電網經理：*8443*
* 租戶經理：*9443*
* 網格經理和租戶經理：*443*


*注意*：您可以使用這些預設連接埠或其他可用連接埠。



 a| 
介面類型
 a| 
選擇您將使用此端點存取的StorageGRID介面的單選按鈕。



 a| 
不受信任的客戶端網絡
 a| 
如果此端點可供不受信任的客戶端網路訪問，請選擇「是」。否則，選擇“否”。

當您選擇「是」時，該連接埠在所有不受信任的用戶端網路上均處於開啟狀態。

*注意*：建立負載平衡器端點時，您只能將連接埠配置為對不受信任的用戶端網路開放或關閉。

|===
--
====
. 選擇*繼續*。




=== 選擇綁定模式

.步驟
. 選擇端點的綁定模式來控制如何使用任意 IP 位址或使用特定 IP 位址和網路介面存取端點。
+
某些綁定模式適用於客戶端端點或管理介面端點。兩種端點類型的所有模式均列於此。

+
[cols="1a,3a"]
|===
| 模式 | 描述 


 a| 
全域（客戶端端點的預設設定）
 a| 
用戶端可以使用任何網關節點或管理節點的 IP 位址、任何網路上任何 HA 群組的虛擬 IP (VIP) 位址或對應的 FQDN 存取端點。

除非您需要限制此端點的可存取性，否則請使用*全域*設定。



 a| 
HA 群組的虛擬 IP
 a| 
用戶端必須使用 HA 群組的虛擬 IP 位址（或對應的 FQDN）來存取此端點。

具有此綁定模式的端點都可以使用相同的連接埠號，只要您為端點選擇的 HA 群組不重疊。



 a| 
節點介面
 a| 
用戶端必須使用選定節點介面的 IP 位址（或對應的 FQDN）來存取此端點。



 a| 
節點類型（僅限客戶端端點）
 a| 
根據您選擇的節點類型，用戶端必須使用任何管理節點的 IP 位址（或對應的 FQDN）或任何網關節點的 IP 位址（或對應的 FQDN）來存取此端點。



 a| 
所有管理節點（管理介面端點的預設設定）
 a| 
用戶端必須使用任何管理節點的 IP 位址（或對應的 FQDN）來存取此端點。

|===
+
如果多個端點使用相同的端口， StorageGRID將使用此優先權順序來決定使用哪個端點：*HA 群組的虛擬 IP* > *節點介面* > *節點類型* > *全域*。

+
如果您正在建立管理介面端點，則只允許管理節點。

. 如果您選擇了*HA 群組的虛擬 IP*，請選擇一個或多個 HA 群組。
+
如果您正在建立管理介面端點，請選擇僅與管理節點關聯的 VIP。

. 如果您選擇了*節點介面*，請為要與此端點關聯的每個管理節點或網關節點選擇一個或多個節點介面。
. 如果您選擇了*節點類型*，請選擇管理節點（包括主管理節點和任何非主管理節點）或網關節點。




=== 控制租戶訪問


NOTE: 管理介面端點僅當端點具有<<enter-endpoint-details,租用戶管理器的介面類型>>。

.步驟
. 對於「租戶存取」步驟，選擇以下選項之一：
+
[cols="1a,2a"]
|===
| 場地 | 描述 


 a| 
允許所有租戶（預設）
 a| 
所有租用戶帳戶都可以使用此端點存取他們的儲存桶。

如果您尚未建立任何租用戶帳戶，則必須選擇此選項。新增租用戶帳戶後，您可以編輯負載平衡器端點以允許或封鎖特定帳戶。



 a| 
允許選定的租戶
 a| 
只有選定的租用戶帳戶可以使用此端點存取他們的儲存桶。



 a| 
阻止選定的租戶
 a| 
選定的租用戶帳戶不能使用此端點存取其儲存桶。所有其他租戶都可以使用此端點。

|===
. 如果您正在建立 *HTTP* 端點，則無需附加憑證。選擇“*創建*”以新增新的負載平衡器端點。然後，轉到<<after-you-finish,完成後>>。否則，請選擇“*繼續*”以附加憑證。




=== 附上證書

.步驟
. 如果您正在建立 *HTTPS* 端點，請選擇要附加至該端點的安全性憑證類型。
+
此憑證可保護 S3 用戶端與管理節點或閘道點上的負載平衡器服務之間的連線。

+
** *上傳證書*。如果您有自訂憑證需要上傳，請選擇此選項。
** *產生證書*。如果您擁有產生自訂憑證所需的值，請選擇此選項。
** *使用StorageGRID S3 憑證*。如果您想使用全域 S3 API 證書，請選擇此選項，該證書也可用於直接連接到儲存節點。
+
除非您已將由網格 CA 簽署的預設 S3 API 證書替換為由外部證書頒發機構簽署的自訂證書，否則您無法選擇此選項。看link:../admin/configuring-custom-server-certificate-for-storage-node.html["配置 S3 API 證書"] 。

** *使用管理介面證書*。如果您想使用全域管理介面證書，請選擇此選項，該證書也可用於直接連接到管理節點。


. 如果您不使用StorageGRID S3 證書，請上傳或產生該證書。
+
[role="tabbed-block"]
====
.上傳證書
--
.. 選擇*上傳證書*。
.. 上傳所需的伺服器憑證檔案：
+
*** *伺服器憑證*：PEM編碼的自訂伺服器憑證檔案。
*** *證書私鑰*：自訂伺服器憑證私鑰文件(`.key`）。
+

NOTE: EC 私鑰必須為 224 位元或更大。  RSA 私鑰必須為 2048 位元或更大。

*** *CA 包*：一個可選文件，包含來自每個中間發行憑證機構 (CA) 的憑證。該文件應包含每個 PEM 編碼的 CA 憑證文件，並按憑證鏈順序連接。


.. 展開*證書詳細資訊*以查看您上傳的每個證書的元資料。如果您上傳了可選的 CA 包，則每個憑證都會顯示在其自己的標籤上。
+
*** 選擇*下載憑證*儲存憑證檔案或選擇*下載 CA 套件*儲存憑證套件。
+
指定證書檔案名稱和下載位置。使用副檔名儲存檔案 `.pem`。

+
例如：  `storagegrid_certificate.pem`

*** 選擇*複製憑證 PEM*或*複製 CA 套件 PEM*以複製憑證內容以便貼上到其他地方。


.. 選擇“*創建*”。+ 負載平衡器端點已建立。自訂憑證用於 S3 用戶端或管理介面與端點之間的所有後續新連線。


--
.產生證書
--
.. 選擇*產生證書*。
.. 指定證書資訊：
+
[cols="1a,3a"]
|===
| 場地 | 描述 


 a| 
網域
 a| 
證書中包含的一個或多個完全限定域名。使用 * 作為通配符來表示多個網域。



 a| 
智慧財產
 a| 
證書中包含的一個或多個 IP 位址。



 a| 
主題（可選）
 a| 
證書擁有者的 X.509 主題或專有名稱 (DN)。

如果此欄位未輸入任何值，則產生的憑證將使用第一個網域名稱或 IP 位址作為主題通用名稱 (CN)。



 a| 
有效天數
 a| 
證書建立後過期的天數。



 a| 
新增密鑰使用擴展
 a| 
如果選擇（預設和推薦），密鑰使用和擴展密鑰使用擴充將新增至產生的憑證。

這些擴充定義了憑證中包含的金鑰的用途。

*注意*：請選取此複選框，除非當憑證包含這些擴充功能時您遇到與舊用戶端的連線問題。

|===
.. 選擇*生成*。
.. 選擇*證書詳細資訊*以查看產生的證書的元資料。
+
*** 選擇*下載證書*儲存證書檔案。
+
指定證書檔案名稱和下載位置。使用副檔名儲存檔案 `.pem`。

+
例如：  `storagegrid_certificate.pem`

*** 選擇*複製證書 PEM* 以複製證書內容並貼上到其他地方。


.. 選擇“*創建*”。
+
負載平衡器端點已建立。自訂憑證用於 S3 用戶端或管理介面與此端點之間的所有後續新連線。



--
====




=== 完成後

.步驟
. 如果您使用 DNS，請確保 DNS 包含一筆記錄，以將StorageGRID完全限定網域名稱 (FQDN) 與用戶端將用於建立連線的每個 IP 位址關聯。
+
您在 DNS 記錄中輸入的 IP 位址取決於您是否使用負載平衡節點的 HA 群組：

+
** 如果您已設定 HA 群組，用戶端將連線至該 HA 群組的虛擬 IP 位址。
** 如果您不使用 HA 群組，用戶端將使用網關節點或管理節點的 IP 位址連線至StorageGRID負載平衡器服務。
+
您還必須確保 DNS 記錄引用所有必要的端點域名，包括任何通配符名稱。



. 向 S3 用戶端提供連接到端點所需的資訊：
+
** 連接埠號
** 完全限定網域名稱或 IP 位址
** 任何所需的證書詳細信息






== 檢視並編輯負載平衡器端點

您可以查看現有負載平衡器端點的詳細信息，包括安全端點的憑證元資料。您可以變更端點的某些設定。

* 要查看所有負載平衡器端點的基本信息，請查看負載平衡器端點頁面上的表格。
* 若要查看有關特定端點的所有詳細資訊（包括憑證元資料），請在表中選擇該端點的名稱。顯示的資訊會根據端點類型及其配置方式而有所不同。
+
image::../media/load_balancer_endpoint_details.png[負載平衡器端點詳細信息]

* 若要編輯端點，請使用負載平衡器端點頁面上的「操作」功能表。
+

NOTE: 如果在編輯管理介面端點的連接埠時失去對網格管理器的存取權限，請更新 URL 和連接埠以重新取得存取權限。

+

TIP: 編輯端點後，您可能需要等待最多 15 分鐘才能將變更套用到所有節點。

+
[cols="1a, 2a,2a"]
|===
| 任務 | 操作選單 | 詳細資訊頁面 


 a| 
編輯端點名稱
 a| 
.. 選取端點的複選框。
.. 選擇*動作* > *編輯端點名稱*。
.. 輸入新名稱。
.. 選擇*儲存*。

 a| 
.. 選擇端點名稱以顯示詳細資訊。
.. 選擇編輯圖標image:../media/icon_edit_tm.png["編輯圖示"]。
.. 輸入新名稱。
.. 選擇*儲存*。




 a| 
編輯端點埠
 a| 
.. 選取端點的複選框。
.. 選擇“操作”>“編輯端點連接埠”
.. 輸入有效的連接埠號碼。
.. 選擇*儲存*。

 a| 
_無_



 a| 
編輯端點綁定模式
 a| 
.. 選取端點的複選框。
.. 選擇*操作* > *編輯端點綁定模式*。
.. 根據需要更新綁定模式。
.. 選擇“儲存變更”。

 a| 
.. 選擇端點名稱以顯示詳細資訊。
.. 選擇*編輯綁定模式*。
.. 根據需要更新綁定模式。
.. 選擇“儲存變更”。




 a| 
編輯端點憑證
 a| 
.. 選取端點的複選框。
.. 選擇*動作* > *編輯端點憑證*。
.. 根據需要上傳或產生新的自訂憑證或開始使用全域 S3 憑證。
.. 選擇“儲存變更”。

 a| 
.. 選擇端點名稱以顯示詳細資訊。
.. 選擇“*證書*”選項卡。
.. 選擇*編輯證書*。
.. 根據需要上傳或產生新的自訂憑證或開始使用全域 S3 憑證。
.. 選擇“儲存變更”。




 a| 
編輯租戶存取權限
 a| 
.. 選取端點的複選框。
.. 選擇*操作* > *編輯租戶存取*。
.. 選擇不同的存取選項，從清單中選擇或刪除租戶，或同時執行這兩項操作。
.. 選擇“儲存變更”。

 a| 
.. 選擇端點名稱以顯示詳細資訊。
.. 選擇“租戶訪問”標籤。
.. 選擇*編輯租戶訪問*。
.. 選擇不同的存取選項，從清單中選擇或刪除租戶，或同時執行這兩項操作。
.. 選擇“儲存變更”。


|===




== 刪除負載平衡器端點

您可以使用「動作」功能表刪除一個或多個端點，也可以從詳細資料頁面中刪除單一端點。


CAUTION: 為防止用戶端中斷，請在刪除負載平衡器端點之前更新任何受影響的 S3 用戶端應用程式。更新每個用戶端以使用分配給另一個負載平衡器端點的連接埠進行連線。請務必更新所有必要的證書資訊。


NOTE: 如果在刪除管理介面端點時失去對網格管理器的存取權限，請更新 URL。

* 若要刪除一個或多個端點：
+
.. 在負載平衡器頁面中，選取要刪除的每個端點的核取方塊。
.. 選擇*操作* > *刪除*。
.. 選擇“確定”。


* 若要從詳細資料頁面中刪除一個端點：
+
.. 從負載平衡器頁面選擇端點名稱。
.. 在詳細資料頁面上選擇“*刪除*”。
.. 選擇“確定”。



