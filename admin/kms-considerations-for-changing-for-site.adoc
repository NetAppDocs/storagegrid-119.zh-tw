---
permalink: admin/kms-considerations-for-changing-for-site.html 
sidebar: sidebar 
keywords: kms cluster, copy kms encryption key 
summary: 每個金鑰管理伺服器（KMS）或 KMS 叢集為單一網站或一組網站的所有裝置節點提供加密金鑰。如果您需要變更網站使用的 KMS，則可能需要將加密金鑰從一個 KMS 複製到另一個 KMS。 
---
= 更改站點 KMS 的注意事項
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
每個金鑰管理伺服器 (KMS) 或 KMS 叢集會向單一網站或一組網站的所有裝置節點提供加密金鑰。如果您需要變更網站使用的 KMS，則可能需要將加密金鑰從一個 KMS 複製到另一個 KMS。

如果您變更網站所使用的 KMS，則必須確保該網站上先前加密的裝置節點可以使用儲存在新 KMS 上的金鑰解密。在某些情況下，您可能需要將目前版本的加密金鑰從原始 KMS 複製到新的 KMS。您必須確保 KMS 具有正確的金鑰來解密網站上的加密裝置節點。

例如：

. 您最初配置一個適用於所有沒有專用 KMS 的網站的預設 KMS。
. 儲存 KMS 後，所有啟用了 *節點加密* 設定的裝置節點都會連接到 KMS 並要求加密金鑰。此金鑰用於加密所有網站的設備節點。也必須使用相同的金鑰來解密這些裝置。
+
image::../media/kms_default_key.png[KMS 預設密鑰]

. 您決定為一個站點（圖中的資料中心 3）新增特定於站點的 KMS。但是，由於裝置節點已加密，因此當您嘗試儲存網站特定 KMS 的設定時會發生驗證錯誤。發生該錯誤的原因是網站特定的 KMS 沒有正確的金鑰來解密該網站的節點。
+
image::../media/kms_wrong_key.png[KMS 金鑰錯誤]

. 為了解決這個問題，您可以將目前版本的加密金鑰從預設 KMS 複製到新的 KMS。 （從技術上講，您將原始金鑰複製到具有相同別名的新金鑰。原始密鑰將成為新密鑰的先前版本。 ）網站特定的 KMS 現在具有解密資料中心 3 的裝置節點的正確金鑰，因此可以將其保存在StorageGRID中。
+
image::../media/kms_copied_key.png[KMS 複製金鑰]





== 更改網站所用 KMS 的用例

該表總結了更改站點 KMS 的最常見情況所需的步驟。

[cols="1a,2a"]
|===
| 更改網站 KMS 的用例 | 必要步驟 


 a| 
您有一個或多個特定於網站的 KMS 條目，並且想要使用其中一個作為預設 KMS。
 a| 
編輯特定於站點的 KMS。在「管理金鑰」欄位中，選擇「未由其他 KMS 管理的網站（預設為 KMS）」。站點特定的 KMS 現在將用作預設 KMS。它將適用於任何沒有專用 KMS 的網站。

link:kms-editing.html["編輯金鑰管理伺服器 (KMS)"]



 a| 
您有一個預設的 KMS，並且在擴充功能中新增了一個新網站。您不想對新網站使用預設的 KMS。
 a| 
. 如果新網站的裝置節點已由預設 KMS 加密，請使用 KMS 軟體將目前版本的加密金鑰從預設 KMS 複製到新的 KMS。
. 使用網格管理器新增新的 KMS 並選擇網站。


link:kms-adding.html["新增金鑰管理伺服器 (KMS)"]



 a| 
您希望網站的 KMS 使用不同的伺服器。
 a| 
. 如果網站上的裝置節點已被現有 KMS 加密，請使用 KMS 軟體將目前版本的加密金鑰從現有 KMS 複製到新的 KMS。
. 使用網格管理器，編輯現有的 KMS 設定並輸入新的主機名稱或 IP 位址。


link:kms-adding.html["新增金鑰管理伺服器 (KMS)"]

|===