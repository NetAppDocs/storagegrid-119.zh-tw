---
permalink: ubuntu/configuring-host-network.html 
sidebar: sidebar 
keywords: how to configure ubuntu or debian host network 
summary: 在主機上完成 Linux 安裝後，您可能需要執行一些額外的配置，以在每個主機上準備一組適合映射到稍後部署的StorageGRID節點的網路介面。 
---
= 設定主機網路（Ubuntu 或 Debian）
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
在主機上完成 Linux 安裝後，您可能需要執行一些額外的配置，以在每個主機上準備一組適合映射到稍後部署的StorageGRID節點的網路介面。

.開始之前
* 您已審閱link:../network/index.html["StorageGRID網路指南"]。
* 您已查看有關link:node-container-migration-requirements.html["節點容器遷移要求"]。
* 如果您正在使用虛擬主機，您已經閱讀了<<mac_address_cloning_ubuntu,MAC 位址克隆的注意事項與建議>>在配置主機網路之前。



NOTE: 如果您使用虛擬機器作為主機，則應選擇 VMXNET 3 作為虛擬網路介面卡。  VMware E1000 網路介面卡導致在某些 Linux 發行版上部署的StorageGRID容器出現連線問題。

.關於此任務
網格節點必須能夠存取網格網絡，以及可選的管理和客戶端網路。您可以透過建立將主機的實體介面與每個網格節點的虛擬介面相關聯的對應來提供此存取。建立主機介面時，使用友善名稱以便於跨所有主機部署並實現遷移。

主機和一個或多個節點之間可以共用相同的介面。例如，您可能使用相同的介面進行主機存取和節點管理網路訪問，以方便主機和節點維護。儘管主機和各個節點之間可以共享相同的接口，但所有節點都必須具有不同的 IP 位址。  IP 位址不能在節點之間或主機和任何節點之間共用。

您可以使用相同的主機網路介面為主機上的所有StorageGRID節點提供網格網路介面；您可以為每個節點使用不同的主機網路介面；或者您可以在兩者之間做一些事情。但是，您通常不會為單一節點提供相同的主機網路介面作為網格網路介面和管理網路接口，或為一個節點提供相同的主機網路介面作為網格網路介面並為另一個節點提供相同的客戶端網路介面。

您可以透過多種方式完成此任務。例如，如果您的主機是虛擬機，並且您為每個主機部署一個或兩個StorageGRID節點，則可以在虛擬機管理程式中建立正確數量的網路接口，並使用一對一映射。如果您在裸機主機上部署多個節點以供生產使用，則可以利用 Linux 網路堆疊對 VLAN 和 LACP 的支援來實現容錯和頻寬共用。以下部分提供了這兩個範例的詳細方法。您不需要使用其中任何一個範例；您可以使用任何滿足您需求的方法。


NOTE: 請勿直接使用綁定或橋接設備作為容器網路介面。這樣做可以防止由於容器命名空間中結合使用 MACVLAN 和橋接設備而導致的核心問題而導致的節點啟動。相反，使用非綁定設備，例如 VLAN 或虛擬乙太網路 (veth) 對。在節點設定檔中將此設備指定為網路介面。



== MAC 位址克隆的注意事項與建議

.[[mac_address_cloning_ubuntu]]
MAC 位址克隆會導致容器使用主機的 MAC 位址，而主機使用您指定的位址或隨機產生的 MAC 位址。您應該使用 MAC 位址複製來避免使用混雜模式網路配置。



=== 啟用 MAC 克隆

在某些環境中，可以透過 MAC 位址複製來增強安全性，因為它使您能夠為管理網路、網格網路和用戶端網路使用專用虛擬 NIC。讓容器使用主機上專用 NIC 的 MAC 位址可以避免使用混雜模式網路配置。


NOTE: MAC 位址複製旨在與虛擬伺服器安裝一起使用，並且可能無法在所有實體設備配置中正常運作。


NOTE: 如果由於 MAC 克隆目標介面繁忙而導致節點啟動失敗，則可能需要在啟動節點之前將連結設定為「關閉」。此外，虛擬環境可能會在連結啟動時阻止網路介面上的 MAC 克隆。如果由於介面繁忙而導致節點無法設定 MAC 位址並啟動，則在啟動節點之前將連結設定為「關閉」可能會解決該問題。

預設情況下，MAC 位址克隆是停用的，必須透過節點配置鍵進行設定。您應該在安裝StorageGRID時啟用它。

每個網路都有一個密鑰：

* `ADMIN_NETWORK_TARGET_TYPE_INTERFACE_CLONE_MAC`
* `GRID_NETWORK_TARGET_TYPE_INTERFACE_CLONE_MAC`
* `CLIENT_NETWORK_TARGET_TYPE_INTERFACE_CLONE_MAC`


將該鍵設為「true」會導致容器使用主機 NIC 的 MAC 位址。此外，主機將使用指定容器網路的 MAC 位址。預設情況下，容器位址是隨機產生的位址，但如果您使用 `_NETWORK_MAC`節點配置金鑰，則使用該位址。主機和容器總是會有不同的 MAC 位址。


NOTE: 如果在虛擬主機上啟用 MAC 複製而沒有在虛擬機器管理程式上啟用混雜模式，可能會導致使用主機介面的 Linux 主機網路停止運作。



=== MAC 克隆用例

MAC 克隆有兩種用例需要考慮：

* MAC 克隆未啟用：當 `_CLONE_MAC`如果節點設定檔中的 鍵未設置，或設定為“false”，則主機將使用主機 NIC MAC，而容器將具有StorageGRID產生的 MAC，除非在 `_NETWORK_MAC`鑰匙。如果在 `_NETWORK_MAC`鍵，容器將具有在 `_NETWORK_MAC`鑰匙。這種密鑰配置需要使用混雜模式。
* 啟用 MAC 克隆：當 `_CLONE_MAC`節點設定檔中的鍵設定為“true”，容器使用主機 NIC MAC，主機使用StorageGRID產生的 MAC，除非在 `_NETWORK_MAC`鑰匙。如果在 `_NETWORK_MAC`金鑰，主機使用指定的位址而不是產生的位址。在這種金鑰配置中，您不應該使用混雜模式。



NOTE: 如果您不想使用 MAC 位址克隆，而是允許所有介面接收和傳輸除虛擬機器管理程式指派的 MAC 位址之外的 MAC 位址的數據，請確保虛擬交換器和連接埠群組層級的安全屬性設定為混雜模式、MAC 位址變更和偽造傳輸的 *接受*。虛擬交換器上設定的值可能會被連接埠群組層級的值覆蓋，因此請確保兩個地方的設定相同。

若要啟用 MAC 克隆，請參閱link:creating-node-configuration-files.html["建立節點設定檔的說明"]。



=== MAC 克隆範例

啟用 MAC 克隆的範例，其中主機的 MAC 位址為 11:22:33:44:55:66，介面為 ens256，節點設定檔中包含以下按鍵：

* `ADMIN_NETWORK_TARGET = ens256`
* `ADMIN_NETWORK_MAC = b2:9c:02:c2:27:10`
* `ADMIN_NETWORK_TARGET_TYPE_INTERFACE_CLONE_MAC = true`


結果：ens256 的主機 MAC 為 b2:9c:02:c2:27:10，管理網路 MAC 為 11:22:33:44:55:66



== 範例 1：一對一對應到實體或虛擬 NIC

範例 1 描述了一個簡單的實體介面映射，它幾乎不需要或根本不需要主機端配置。

image::../media/rhel_install_vlan_diag_1.gif[VLAN 圖]

Linux 作業系統在安裝或啟動期間，或在熱添加介面時自動建立 ensXYZ 介面。除了確保介面設定為啟動後自動啟動之外，不需要進行任何設定。您必須確定哪個 ensXYZ 對應哪個StorageGRID網路（網格、管理或用戶端），以便您可以在稍後的設定過程中提供正確的對應。

請注意，圖中顯示了多個StorageGRID節點；但是，您通常會將此配置用於單節點虛擬機器。

如果交換器 1 是實體交換機，則應將連接到介面 10G~1~ 至 10G~3~ 的連接埠配置為存取模式，並將它們放置在適當的 VLAN 上。



== 範例 2：承載 VLAN 的 LACP 綁定

範例 2 假設您熟悉綁定網路介面以及如何在您所使用的 Linux 發行版上建立 VLAN 介面。

.關於此任務
範例 2 描述了一種通用、靈活、基於 VLAN 的方案，該方案有助於在單一主機上的所有節點之間共享所有可用的網路頻寬。此範例特別適用於裸機主機。

為了理解這個例子，假設每個資料中心都有三個獨立的子網，分別為網格、管理和客戶端網路。子網路位於單獨的 VLAN（1001、1002 和 1003）上，並透過 LACP 綁定中繼連接埠（bond0）呈現給主機。您將在綁定上配置三個 VLAN 介面：bond0.1001、bond0.1002 和 bond0.1003。

如果需要為同一台主機上的節點網路使用單獨的 VLAN 和子網，則可以在綁定上新增 VLAN 介面並將其對應到主機中（圖中顯示為 bond0.1004）。

image::../media/rhel_install_vlan_diag_2.gif[該圖像由周圍的文字解釋。]

.步驟
. 將用於StorageGRID網路連線的所有實體網路介面聚合到單一 LACP 綁定中。
+
對每個主機上的綁定使用相同的名稱，例如 bond0。

. 使用標準 VLAN 介面命名約定建立使用此綁定作為其關聯「實體設備」的 VLAN 介面 `physdev-name.VLAN ID`。
+
請注意，步驟 1 和 2 需要在終止網路連結另一端的邊緣交換器上進行適當的設定。邊緣交換器連接埠也必須聚合到 LACP 連接埠通道中，配置為主幹，並允許傳遞所有必要的 VLAN。

+
提供了針對每個主機網路配置方案的範例介面設定檔。



.相關資訊
link:example-etc-network-interfaces.html["範例 /etc/network/interfaces"]
