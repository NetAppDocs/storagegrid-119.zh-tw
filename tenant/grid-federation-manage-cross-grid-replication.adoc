---
permalink: tenant/grid-federation-manage-cross-grid-replication.html 
sidebar: sidebar 
keywords: grid federation, cross-grid replication, use grid federation connection, replicate client delete markers, s3 bucket 
summary: 如果您的租用戶帳戶在建立時被指派了使用網格聯合連線權限，則可以使用跨網格複製在租用戶來源網格上的儲存桶和租用戶目標網格上的儲存桶之間自動複製物件。跨網格複製可以單向或雙向進行。 
---
= 管理跨網格複製
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
如果您的租用戶帳戶在建立時被指派了 *使用網格聯合連線* 權限，則您可以使用跨網格複製在租用戶來源網格上的儲存桶和租用戶目標網格上的儲存桶之間自動複製物件。跨網格複製可以單向或雙向進行。



== 跨網格複製的工作流程

工作流程圖總結了配置兩個網格上的儲存桶之間的跨網格複製所要執行的步驟。以下將更詳細地描述這些步驟。

image::../media/grid-federation-cgr-workflow.png[跨網格複製工作流程]



== 配置跨網格複製

在使用跨網格複製之前，您必須登入每個網格上對應的租用戶帳戶並建立相同的儲存桶。然後，您可以在一個或兩個儲存桶上啟用跨網格複製。

.開始之前
* 您已查看了跨網格複製的要求。看link:../admin/grid-federation-what-is-cross-grid-replication.html["什麼是跨網格複製"] 。
* 您正在使用link:../admin/web-browser-requirements.html["支援的網頁瀏覽器"]。
* 租用戶帳戶具有*使用網格聯合連線*權限，且兩個網格上都存在相同的租用戶帳戶。看link:../admin/grid-federation-manage-tenants.html["管理允許的電網聯合連接租戶"] 。
* 您將以該身分登入的租戶使用者已存在於兩個網格中，並且屬於具有link:tenant-management-permissions.html["Root存取權限"]。
* 如果您將以本機使用者身分登入租用戶的目標網格，則租用戶帳戶的根使用者已為您在該網格上的使用者帳戶設定了密碼。




=== 建立兩個相同的儲存桶

第一步，登入每個網格上對應的租戶帳戶並建立相同的儲存桶。

.步驟
. 從網格聯合連接中的任一網格開始，建立一個新的儲存桶：
+
.. 使用兩個網格上都存在的租戶使用者的憑證Sign in租戶帳戶。
+

NOTE: 如果您無法以本機使用者身分登入租用戶的目標網格，請確認租用戶帳戶的根用戶已為您的使用者帳戶設定密碼。

.. 按照說明link:creating-s3-bucket.html["建立一個 S3 儲存桶"]。
.. 在*管理物件設定*標籤上，選擇*啟用物件版本控制*。
.. 如果您的StorageGRID系統啟用了 S3 物件鎖，請不要為儲存桶啟用 S3 物件鎖。
.. 選擇*建立儲存桶*。
.. 選擇*完成*。


. 重複這些步驟，為網格聯合連接中的另一個網格上的相同租用戶帳戶建立相同的儲存桶。
+

TIP: 根據需要，每個儲存桶可以使用不同的區域。





=== 啟用跨網格複製

在將任何物件新增至任一儲存桶之前，您必須執行這些步驟。

.步驟
. 從要複製物件的網格開始，啟用link:../admin/grid-federation-what-is-cross-grid-replication.html["單向跨網格複製"]：
+
.. Sign in儲存桶的租用戶帳戶。
.. 從儀表板中選擇 *查看儲存桶*，或選擇 *儲存（S3）* > *儲存桶*。
.. 從表格中選擇儲存桶名稱以存取儲存桶詳細資訊頁面。
.. 選擇*跨網格複製*標籤。
.. 選擇*啟用*，並查看要求清單。
.. 如果所有要求都已滿足，請選擇要使用的電網聯合連接。
.. 或者，變更 *複製刪除標記* 的設置，以確定當 S3 用戶端向來源網格發出不包含版本 ID 的刪除請求時目標網格上會發生什麼：
+
*** *是*（預設）：將刪除標記新增至來源儲存桶並複製到目標儲存桶。
*** *否*：刪除標記已新增至來源儲存桶，但未複製到目標儲存桶。
+
image::../media/grid-federation-cross-grid-replication-client-deletes.png[該圖顯示了兩個網格上的複製客戶端刪除]

+

NOTE: 如果刪除請求包含版本 ID，則該物件版本將從來源儲存桶中永久刪除。StorageGRID不會複製包含版本 ID 的刪除要求，因此不會從目標中刪除相同的物件版本。

+
看link:../admin/grid-federation-what-is-cross-grid-replication.html["什麼是跨網格複製"]了解詳情。



.. 或者，變更「跨網格複製」審計類別的設定來管理審計訊息的數量：
+
*** *錯誤*（預設）：審計輸出中僅包含失敗的跨網格複製請求。
*** *正常*：包括所有跨網格複製請求，這顯著增加了審計輸出量。


.. 檢查您的選擇。除非兩個儲存桶都為空，否則您無法變更這些設定。
.. 選擇*啟用並測試*。
+
片刻之後，會出現成功訊息。新增至此儲存桶的物件現在將自動複製到另一個網格。*跨網格複製*在儲存桶詳細資料頁面上顯示為已啟用的功能。



. 或者，轉到另一個網格上的相應儲存桶，然後link:../admin/grid-federation-what-is-cross-grid-replication.html["啟用雙向跨網格複製"]。




== 測試網格之間的複製

如果為儲存桶啟用了跨網格複製，您可能需要驗證連線和跨網格複製是否正常運作，以及來源儲存桶和目標儲存桶是否仍符合所有要求（例如，版本控制仍然啟用）。

.開始之前
* 您正在使用link:../admin/web-browser-requirements.html["支援的網頁瀏覽器"]。
* 您屬於具有link:tenant-management-permissions.html["Root存取權限"]。


.步驟
. Sign in儲存桶的租用戶帳戶。
. 從儀表板中選擇 *查看儲存桶*，或選擇 *儲存（S3）* > *儲存桶*。
. 從表格中選擇儲存桶名稱以存取儲存桶詳細資訊頁面。
. 選擇*跨網格複製*標籤。
. 選擇*測試連線*。
+
如果連接正常，則會出現成功橫幅。否則，會出現一條錯誤訊息，您和網格管理員可以使用它來解決問題。有關詳細信息，請參閱link:../admin/grid-federation-troubleshoot.html["解決網格聯合錯誤"] 。

. 如果跨網格複製配置為雙向進行，請轉到另一個網格上的相應儲存桶並選擇*測試連接*以驗證跨網格複製是否在另一個方向上有效。




== 禁用跨網格複製

如果您不再想將物件複製到另一個網格，您可以永久停止跨網格複製。

在停用跨網格複製之前，請注意以下事項：

* 停用跨網格複製不會刪除任何已在網格之間複製的物件。例如， `my-bucket`網格 1 上已複製到 `my-bucket`如果您停用該儲存桶的跨網格複製，則網格 2 上的資料不會被刪除。如果要刪除這些對象，則必須手動將其刪除。
* 如果每個儲存桶都啟用了跨網格複製（即，如果複製在兩個方向上發生），則可以停用一個或兩個儲存桶的跨網格複製。例如，您可能想要停用從 `my-bucket`在網格 1 上 `my-bucket`在網格 2 上，同時繼續從 `my-bucket`在網格 2 上 `my-bucket`在網格 1 上。
* 您必須先停用跨網格複製，然後才能刪除租用戶使用網格聯合連線的權限。看link:../admin/grid-federation-manage-tenants.html["管理獲準租戶"] 。
* 如果您停用包含對象的儲存桶的跨網格複製，除非您從來源儲存桶和目標儲存桶中刪除所有對象，否則將無法重新啟用跨網格複製。
+

CAUTION: 除非兩個儲存桶都為空，否則您無法重新啟用複製。



.開始之前
* 您正在使用link:../admin/web-browser-requirements.html["支援的網頁瀏覽器"]。
* 您屬於具有link:tenant-management-permissions.html["Root存取權限"]。


.步驟
. 從不再需要複製其物件的網格開始，停止儲存桶的跨網格複製：
+
.. Sign in儲存桶的租用戶帳戶。
.. 從儀表板中選擇 *查看儲存桶*，或選擇 *儲存（S3）* > *儲存桶*。
.. 從表格中選擇儲存桶名稱以存取儲存桶詳細資訊頁面。
.. 選擇*跨網格複製*標籤。
.. 選擇*禁用複製*。
.. 如果您確定要停用此儲存桶的跨網格複製，請在文字方塊中輸入*是*，然後選擇*停用*。
+
片刻之後，會出現成功訊息。新增至此儲存桶的新物件無法再自動複製到其他網格。  *跨網格複製*不再在 Buckets 頁面上顯示為已啟用的功能。



. 如果跨網格複製配置為雙向進行，請轉到另一個網格上的相應儲存桶並停止另一個方向的跨網格複製。

