---
permalink: maintain/considerations-for-removing-site.html 
sidebar: sidebar 
keywords: how to remove site 
summary: 在使用網站退役程式刪除網站之前，您必須查看注意事項。 
---
= 刪除網站的注意事項
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
在使用網站退役程式刪除網站之前，您必須查看注意事項。



== 當你關閉一個網站時會發生什麼

當您退役某個網站時， StorageGRID會從StorageGRID系統中永久刪除該網站上的所有節點以及網站本身。

當場地退役程序完成後：

* 您無法再使用StorageGRID檢視或造訪該網站或網站上的任何節點。
* 您不能再使用引用該網站的任何儲存池或擦除編碼設定檔。當StorageGRID退役某個網站時，它會自動刪除這些儲存池並停用這些擦除編碼設定檔。




== 連接站點和斷開站點退役程序之間的差異

您可以使用站點退役程式來刪除所有節點都連接到StorageGRID 的站點（稱為連接站點退役）或刪除所有節點都與StorageGRID斷開連接的站點（稱為斷開站點退役）。在開始之前，您必須了解這些過程之間的差異。


NOTE: 如果一個站點包含連接的混合物（image:../media/icon_alert_green_checkmark.png["圖示警報綠色複選標記"] ) 和斷開的節點 (image:../media/icon_alarm_gray_administratively_down.png["圖示警報灰色管理關閉"]或者image:../media/icon_alarm_blue_unknown.png["圖標警報藍色未知"])，您必須將所有離線節點重新連線。

* 連接站點退役允許您從StorageGRID系統中刪除一個可操作站點。例如，您可以執行已連線網站退役來刪除可執行但不再需要的網站。
* 當StorageGRID刪除連接的網站時，它會使用 ILM 來管理該網站的物件資料。在開始已連接網站退役之前，您必須從所有 ILM 規則中刪除網站並啟動新的 ILM 策略。遷移物件資料的 ILM 流程和刪除網站的內部流程可以同時發生，但最佳做法是在開始實際退役程序之前讓 ILM 步驟完成。
* 斷開連線的站點退役可讓您從StorageGRID系統中刪除故障站點。例如，您可以執行斷開站點退役來移除已被火災或洪水摧毀的站點。
+
當StorageGRID刪除斷開連接的網站時，它會認為所有節點都不可恢復，並且不會嘗試保存資料。但是，在開始斷開網站的退役之前，您必須從所有 ILM 規則中刪除網站並啟動新的 ILM 策略。

+

CAUTION: 在執行斷開網站退役程序之前，您必須聯絡您的NetApp客戶代表。在啟用「退役網站」精靈中的所有步驟之前， NetApp將會審核您的要求。如果您認為有可能復原網站或從網站復原物件數據，則不應嘗試中斷網站的退役。





== 刪除已連線或已中斷連線的網站的一般要求

在刪除已連線或已中斷連線的網站之前，您必須注意以下要求：

* 您不能停用包含主管理節點的網站。
* 如果任何節點具有屬於高可用性 (HA) 群組的接口，則您無法停用該網站。您必須編輯 HA 群組以刪除節點的介面或刪除整個 HA 群組。
* 如果一個站點包含混合連接（image:../media/icon_alert_green_checkmark.png["圖示警報綠色複選標記"] ) 和斷開連接 (image:../media/icon_alarm_blue_unknown.png["圖標警報藍色未知"]或者image:../media/icon_alarm_gray_administratively_down.png["圖示警報灰色管理關閉"]) 節點。
* 如果任何其他站點上的任何節點斷開連接，則無法停用該站點（image:../media/icon_alarm_blue_unknown.png["圖標警報藍色未知"]或者image:../media/icon_alarm_gray_administratively_down.png["圖示警報灰色管理關閉"]）。
* 如果 ec-node-repair 作業正在進行中，則您無法啟動網站退役程序。看link:checking-data-repair-jobs.html["檢查資料修復作業"]追蹤擦除編碼資料的修復。
* 在站點退役程式運行時：
+
** 您不能建立引用已退役網站的 ILM 規則。您也無法編輯現有的 ILM 規則來引用該網站。
** 您無法執行其他維護程序，例如擴充或升級。
+

NOTE: 如果您需要在已連接站點退役期間執行其他維護程序，您可以link:pausing-and-resuming-decommission-process-for-storage-nodes.html["在刪除儲存節點時暫停該過程"]。只有在達到 ILM 評估或擦除編碼資料退役階段時才會啟用 *暫停* 按鈕；但是，ILM 評估（資料遷移）將繼續在背景執行。第二次維護程序完成後，即可恢復退役。

** 如果您需要在啟動網站退役程式後恢復任何節點，則必須聯絡支援人員。


* 您不能一次停用多個網站。
* 如果網站包含一個或多個管理節點，且您的StorageGRID系統啟用了單一登入 (SSO)，則必須從 Active Directory 聯合驗證服務 (AD FS) 中刪除該網站的所有依賴方信任。




== 資訊生命週期管理（ILM）的要求

作為刪除網站的一部分，您必須更新 ILM 配置。退役網站精靈將引導您完成一系列先決條件步驟，以確保以下內容：

* 任何 ILM 政策均未提及該網站。如果是，您必須編輯策略或使用新的 ILM 規則建立並啟動策略。
* 沒有 ILM 規則引用該站點，即使這些規則未在任何策略中使用。您必須刪除或編輯所有涉及該網站的規則。


當StorageGRID退役該網站時，它將自動停用引用該網站的任何未使用的擦除編碼設定文件，並且它將自動刪除引用該網站的任何未使用的儲存池。如果所有儲存節點儲存池存在（StorageGRID 11.6 及更早版本），則會將其刪除，因為它使用所有網站。


CAUTION: 在刪除網站之前，您可能需要建立新的 ILM 規則並啟動新的 ILM 策略。這些說明假設您對 ILM 的工作原理有充分的了解，並且熟悉建立儲存池、擦除編碼設定檔、ILM 規則以及模擬和啟動 ILM 策略。看link:../ilm/index.html["使用 ILM 管理對象"] 。



== 連接站點的物件資料注意事項

如果您正在執行已連線網站的退役，則必須決定在建立新的 ILM 規則和新的 ILM 策略時如何處理網站上的現有物件資料。您可以執行以下一項或兩項操作：

* 將物件資料從選定站點移至網格中的一個或多個其他站點。
+
*移動資料的範例*：假設您想要停用羅利的一個站點，因為您在桑尼維爾新增了一個新站點。在此範例中，您想要將所有物件資料從舊網站移至新網站。在更新 ILM 規則和 ILM 策略之前，您必須檢查兩個網站的容量。您必須確保桑尼維爾站點具有足夠的容量來容納來自羅利站點的物件數據，並且桑尼維爾將保留足夠的容量以滿足未來的成長。

+

NOTE: 為了確保有足夠的容量，您可能需要link:../expand/index.html["展開網格"]在執行此程序之前，透過將儲存磁碟區或儲存節點新增至現有網站或新增網站來實現。

* 從選定網站刪除物件副本。
+
*刪除資料的範例*：假設您目前使用 3 副本 ILM 規則在三個網站之間複製物件資料。在退役網站之前，您可以建立等效的 2 副本 ILM 規則以僅在兩個網站儲存資料。當您啟動使用 2 副本規則的新 ILM 策略時， StorageGRID會從第三個網站刪除副本，因為它們不再符合 ILM 要求。但是，物件資料仍將受到保護，其餘兩個站點的容量將保持不變。

+

CAUTION: 切勿建立單一副本 ILM 規則以適應網站的刪除。任何時間段內僅建立一個複製副本的 ILM 規則會使資料面臨永久遺失的風險。如果某個物件的副本只有一個，則當儲存節點發生故障或發生重大錯誤時，該物件將會遺失。在升級等維護過程中，您也會暫時失去對該物件的存取權限。





== 已連接站點退役的附加要求

在StorageGRID刪除已連線的網站之前，您必須確保以下事項：

* StorageGRID系統中的所有節點都必須具有 *Connected* 的連線狀態（image:../media/icon_alert_green_checkmark.png["圖示警報綠色複選標記"] ）；但是，節點可以有活動警報。
+

NOTE: 如果一個或多個節點斷開連接，您可以完成「退役站點」精靈的步驟 1-4。但是，除非所有節點都已連接，否則您無法完成精靈的第 5 步（即啟動退役程序）。

* 如果您計劃刪除的網站包含用於負載平衡的網關節點或管理節點，則可能需要link:../expand/index.html["展開網格"]在另一個站點新增等效的新節點。在開始站點退役程序之前，請確保用戶端可以連接到替換節點。
* 如果您打算刪除的網站包含高可用性 (HA) 群組中的任何網關節點或管理節點，您可以完成退役網站精靈的步驟 1-4。但是，除非您從所有 HA 群組中刪除這些節點，否則您無法完成精靈的第 5 步驟（即啟動退役程序）。如果現有用戶端連接到包含網站節點的 HA 群組，則必須確保它們在網站被刪除後可以繼續連線到StorageGRID 。
* 如果用戶端直接連接到您計劃移除的站點的儲存節點，則必須確保它們可以在開始站點退役程式之前連接到其他站點的儲存節點。
* 您必須在剩餘站點上提供足夠的空間來容納因任何活動 ILM 策略的變更而移動的任何物件資料。在某些情況下，您可能需要link:../expand/index.html["展開網格"]透過新增儲存節點、儲存磁碟區或新站點，然後才能完成已連接站點的退役。
* 您必須留出足夠的時間來完成退役程序。  StorageGRID ILM 流程可能需要幾天、幾週甚至幾個月的時間才能從站點移動或刪除物件數據，然後才能退役站點。
+

NOTE: 從網站移動或刪除物件資料可能需要幾天、幾週甚至幾個月的時間，具體取決於網站的資料量、系統負載、網路延遲以及所需 ILM 變更的性質。

* 只要有可能，您就應該儘早完成退役站點精靈的第 1-4 步。如果您允許在開始實際退役程序之前將資料從網站移出（透過在精靈的步驟 5 中選擇「開始退役」*），則退役程序將更快完成，中斷和效能影響更少。




== 已中斷站點退役的額外要求

在StorageGRID刪除斷開連線的網站之前，您必須確保以下事項：

* 您已聯絡您的NetApp客戶代表。在啟用「退役網站」精靈中的所有步驟之前， NetApp將會審核您的要求。
+

CAUTION: 如果您認為有可能恢復站點或從站點恢復任何物件數據，則不應嘗試斷開站點的退役。看link:how-site-recovery-is-performed-by-technical-support.html["技術支援如何恢復站點"] 。

* 站點上的所有節點必須具有以下之一的連線狀態：
+
** *未知* (image:../media/icon_alarm_blue_unknown.png["圖標警報藍色未知"] ): 由於未知原因，節點斷開連線或節點上的服務意外關閉。例如，節點上的服務可能已停止，或由於電源故障或意外中斷，節點可能已失去網路連線。
** *行政上下降* (image:../media/icon_alarm_gray_administratively_down.png["圖示警報灰色管理關閉"] ): 由於預期原因，節點未連接到電網。例如，節點或節點上的服務已正常關閉。


* 所有其他網站上的所有節點必須具有 *Connected* 的連線狀態（image:../media/icon_alert_green_checkmark.png["圖示警報綠色複選標記"] ）；但是，這些其他節點可以有活動警報。
* 您必須明白，您將無法再使用StorageGRID來檢視或擷取儲存在該網站的任何物件資料。當StorageGRID執行此程序時，它不會嘗試保留斷開連接的站點的任何資料。
+

NOTE: 如果您的 ILM 規則和策略旨在防止單一網站遺失，則物件的副本仍然存在於其餘網站上。

* 您必須明白，如果該網站包含某個物件的唯一副本，則該物件將遺失並且無法檢索。




== 刪除網站時的一致性注意事項

S3 儲存桶的一致性決定了StorageGRID在告知客戶端物件提取成功之前是否將物件元資料完全複製到所有節點和站點。一致性在物件的可用性和不同儲存節點和站點之間的物件的一致性之間提供了平衡。

當StorageGRID刪除一個網站時，它需要確保沒有資料寫入已刪除的網站。因此，它會暫時覆蓋每個桶或容器的一致性。啟動站點退役程序後， StorageGRID會暫時使用強站點一致性來防止物件元資料寫入已刪除的站點。

由於此臨時覆蓋，請注意，如果剩餘站點上的多個節點變得不可用，則站點退役期間發生的任何用戶端寫入、更新和刪除操作都可能失敗。
