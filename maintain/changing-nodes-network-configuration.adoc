---
permalink: maintain/changing-nodes-network-configuration.html 
sidebar: sidebar 
keywords: storagegrid, network configuration, node network configuration 
summary: 您可以使用變更 IP 工具變更一個或多個節點的網路配置。您可以變更網格網路的配置，或新增、變更或刪除管理或客戶端網路。 
---
= 更改節點網路配置
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
您可以使用變更 IP 工具變更一個或多個節點的網路配置。您可以變更網格網路的配置，或新增、變更或刪除管理或客戶端網路。

.開始之前
你有 `Passwords.txt`文件。

.關於此任務
*Linux：*如果您是第一次將網格節點新增至管理網路或用戶端網絡，且先前未在節點設定檔中設定 ADMIN_NETWORK_TARGET 或 CLIENT_NETWORK_TARGET，則必須現在這樣做。

請參閱適用於您的 Linux 作業系統的StorageGRID安裝說明：

* link:../rhel/index.html["在 Red Hat Enterprise Linux 上安裝StorageGRID"]
* link:../ubuntu/index.html["在 Ubuntu 或 Debian 上安裝StorageGRID"]


*設備：*在StorageGRID設備上，如果在初始安裝期間未在StorageGRID設備安裝程式中設定用戶端或管理網絡，則無法僅使用更改 IP 工具新增網路。首先，你必須 https://docs.netapp.com/us-en/storagegrid-appliances/commonhardware/placing-appliance-into-maintenance-mode.html["將設備置於維護模式"^]，配置鏈接，使設備返回正常運行模式，然後使用更改 IP 工具修改網路配置。查看 https://docs.netapp.com/us-en/storagegrid-appliances/installconfig/configuring-network-links.html["設定網路連結的過程"^]。

您可以變更任何網路上一個或多個節點的 IP 位址、子網路遮罩、閘道或 MTU 值。

您也可以從客戶端網路或管理網路中新增或刪除節點：

* 您可以透過為節點新增該網路上的 IP 位址/子網路遮罩，將節點新增至用戶端網路或管理網路。
* 您可以透過刪除該網路上節點的 IP 位址/子網路遮罩來從用戶端網路或管理網路中刪除節點。
+
節點不能從網格網路中刪除。




NOTE: 不允許交換 IP 位址。如果必須在網格節點之間交換 IP 位址，則必須使用臨時中間 IP 位址。


NOTE: 如果您的StorageGRID系統啟用了單一登入 (SSO) 並且您正在變更管理節點的 IP 位址，請注意，使用管理節點的 IP 位址（而不是建議的完全限定網域名稱）配置的任何依賴方信任都會變為無效。您將無法再登入該節點。變更 IP 位址後，必須立即使用新的 IP 位址更新或重新設定 Active Directory 聯合驗證服務 (AD FS) 中節點的信賴方信任。請參閱說明link:../admin/configuring-sso.html["設定 SSO"]。


NOTE: 使用更改 IP 工具對網路所做的任何變更都會傳播到StorageGRID設備的安裝程式韌體。這樣，如果在設備上重新安裝StorageGRID軟體，或將設備置於維護模式，則網路配置將是正確的。

.步驟
. 登入主管理節點：
+
.. 輸入以下命令： `ssh admin@_primary_Admin_Node_IP_`
.. 輸入 `Passwords.txt`文件。
.. 輸入以下命令切換到root： `su -`
.. 輸入 `Passwords.txt`文件。


+
當您以 root 身分登入時，提示字元將從 `$`到 `#`。

. 輸入以下命令啟動更改 IP 工具： `change-ip`
. 在提示符號下輸入設定密碼。
+
出現主選單。

+
image::../media/change_ip_tool_main_menu.png[螢幕截圖顯示了更改 IP 工具的歡迎螢幕]

. （可選）選擇 *1* 來選擇要更新的節點。然後選擇以下選項之一：
+
** *1*: 單節點--按名稱選擇
** *2*：單一節點－按網站選擇，然後按名稱選擇
** *3*: 單節點－按目前IP選擇
** *4*：站點上的所有節點
** *5*：網格中的所有節點
+
*注意：*如果您想更新所有節點，請允許「全部」保持選取狀態。



+
做出選擇後，將出現主選單，其中「選定節點」欄位將更新以反映您的選擇。所有後續操作僅對顯示的節點執行。

. 在主選單上，選擇選項*2*來編輯所選節點的 IP/遮罩、閘道和 MTU 資訊。
+
.. 選擇要進行變更的網路：
+
--
*** *1*：網格網絡
*** *2*：管理網絡
*** *3*：客戶端網絡
*** *4*：所有網絡


--
+
--
做出選擇後，提示會顯示節點名稱、網路名稱（網格、管理或用戶端）、資料類型（IP/遮罩、閘道或 MTU）和目前值。

編輯 DHCP 設定介面的 IP 位址、前綴長度、閘道或 MTU 將會把介面改為靜態。當您選擇變更由 DHCP 設定的介面時，會顯示警告，通知您該介面將變更為靜態。

介面配置為 `fixed`無法編輯。

--
.. 若要設定新值，請依照目前值顯示的格式輸入。
.. 若要保持目前值不變，請按 *Enter*。
.. 如果資料類型是 `IP/mask`，您可以輸入 *d* 或 *0.0.0.0/0* 從節點中移除管理網路或用戶端網路。
.. 編輯完所有想要更改的節點後，輸入 *q* 返回主選單。
+
您的變更將保留，直到被清除或套用為止。



. 選擇以下選項之一來檢查您的變更：
+
** *5*：在隔離的輸出中顯示編輯，僅顯示更改的項目。變更以綠色（新增）或紅色（刪除）突出顯示，如範例輸出所示：
+
image::../media/change_ip_tool_edit_ip_mask_sample_output.png[螢幕截圖由周圍文字描述]

** *6*：在顯示完整配置的輸出中顯示編輯。變更以綠色（新增）或紅色（刪除）突出顯示。
+

NOTE: 某些命令列介面可能會使用刪除線格式顯示新增和刪除的內容。正確顯示取決於您的終端用戶端是否支援必要的 VT100 轉義序列。



. 選擇選項 *7* 來驗證所有變更。
+
此驗證可確保不違反網格、管理和用戶端網路的規則，例如不使用重疊子網路。

+
在此範例中，驗證傳回錯誤。

+
image::../media/change_ip_tool_validate_sample_error_messages.gif[螢幕截圖由周圍文字描述]

+
在此範例中，驗證已通過。

+
image::../media/change_ip_tool_validate_sample_passed_messages.gif[螢幕截圖由周圍文字描述]

. 驗證通過後，選擇以下選項之一：
+
** *8*：儲存未套用的變更。
+
此選項可讓您退出更改 IP 工具並稍後重新啟動，而不會遺失任何未套用的變更。

** *10*：套用新的網路配置。


. 如果您選擇了選項 *10*，請選擇以下選項之一：
+
** *應用*：立即套用更改，並在必要時自動重啟每個節點。
+
如果新的網路配置不需要任何實體網路更改，您可以選擇*應用程式*立即套用變更。如果需要，節點將自動重新啟動。將顯示需要重啟的節點。

** *階段*：下次手動重啟節點時套用變更。
+
如果需要對實體或虛擬網路配置進行更改以使新的網路配置正常運行，則必須使用 *stage* 選項，關閉受影響的節點，進行必要的實體網路更改，然後重新啟動受影響的節點。如果您在沒有先進行這些網路變更的情況下選擇*應用程式*，則變更通常會失敗。

+

NOTE: 如果您使用 *stage* 選項，則必須在暫存後儘快重新啟動節點以盡量減少中斷。

** *取消*：此時不要進行任何網路變更。
+
如果您不知道所提議的變更需要重新啟動節點，您可以推遲變更以盡量減少對使用者的影響。選擇“*取消*”將返回主選單並儲存您的更改，以便您稍後將它們應用。

+
當您選擇*apply*或*stage*時，將產生一個新的網路設定文件，執行配置，並使用新的工作資訊更新節點。

+
在配置期間，輸出顯示套用更新的狀態。

+
[listing]
----
Generating new grid networking description file...

Running provisioning...

Updating grid network configuration on Name
----


+
套用或階段變更後，將根據網格配置變更產生新的復原包。

. 如果您選擇了 *stage*，請在設定完成後請依照下列步驟操作：
+
.. 進行所需的實體或虛擬網路變更。
+
*實體網路變化*：進行必要的實體網路變化，必要時安全關閉節點。

+
*Linux*：如果您是第一次將節點新增至管理網路或用戶端網絡，請確保已依照link:linux-adding-interfaces-to-existing-node.html["Linux：為現有節點新增介面"]。

.. 重新啟動受影響的節點。


. 更改完成後，選擇 *0* 退出更改 IP 工具。
. 從網格管理器下載新的復原套件。
+
.. 選擇*維護* > *系統* > *恢復包*。
.. 輸入配置密碼。



