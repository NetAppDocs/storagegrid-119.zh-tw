---
permalink: maintain/restoring-volume.html 
sidebar: sidebar 
keywords: storagegrid, restore, volume 
summary: 您可以使用網格管理器還原故障儲存磁碟區或儲存節點的物件資料。您也可以使用網格管理器來監控正在進行的恢復過程並顯示恢復歷史記錄。 
---
= 使用網格管理器恢復物件數據
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
您可以使用網格管理器還原故障儲存磁碟區或儲存節點的物件資料。您也可以使用網格管理器來監控正在進行的恢復過程並顯示恢復歷史記錄。

.開始之前
* 您已完成以下任一步驟來格式化失敗的磁碟區：
+
** link:../maintain/remounting-and-reformatting-appliance-storage-volumes.html["重新掛載並重新格式化裝置儲存磁碟區（手動步驟）"]
** link:../maintain/remounting-and-reformatting-storage-volumes-manual-steps.html["重新掛載並重新格式化儲存磁碟區（手動步驟）"]


* 您已確認要恢復物件的儲存節點的連線狀態為“已連線”image:../media/icon_alert_green_checkmark.png["圖示警報綠色複選標記"]在網格管理器中的 *NODES* > *Overview* 標籤上。
* 您已確認以下內容：
+
** 尚未進行新增儲存節點的網格擴充。
** 儲存節點退役未在進行中或已失敗。
** 故障儲存卷的恢復尚未進行。
** 系統驅動器發生故障的儲存節點的恢復尚未進行。
** EC 重新平衡作業尚未進行。
** 設備節點克隆未在進行中。




.關於此任務
更換磁碟機並執行手動步驟格式化磁碟區後，網格管理員會在 *維護* > *磁碟區復原* > *要復原的節點* 標籤上將這些磁碟區顯示為復原的候選磁碟區。

只要有可能，就使用網格管理器中的磁碟區恢復頁面來恢復物件資料。您可以<<enable-auto-restore-mode,啟用自動恢復模式>>當磁碟區準備好恢復時自動啟動磁碟區恢復，或者<<manually-restore,手動執行卷宗恢復>>。請遵循以下準則：

* 如果磁碟區在 *維護* > *磁碟區復原* > *要復原的節點* 中列出，請依照下列步驟還原物件資料。如果滿足以下條件，則會列出卷數：
+
** 節點中的部分（但不是全部）儲存卷發生故障
** 節點中的所有儲存卷均已發生故障，並且正在被相同數量的捲或更多卷替換


+
網格管理器中的磁碟區復原頁面還允許您<<view-restoration-progress,監控卷恢復過程>>和<<view-restoration-history,查看恢復記錄>>。

* 如果網格管理器中未列出要復原的捲，請按照適當的步驟使用 `repair-data`恢復物件資料的腳本：
+
** link:restoring-object-data-to-storage-volume.html["將物件資料還原到儲存磁碟區（系統磁碟機故障）"]
** link:restoring-object-data-to-storage-volume-where-system-drive-is-intact.html["將物件資料還原到系統磁碟機完好的儲存卷"]
** link:restoring-object-data-to-storage-volume-for-appliance.html["將物件資料還原到裝置的儲存卷"]
+

NOTE: 修復資料腳本已棄用，並將在未來版本中刪除。



+
如果復原的儲存節點包含的磁碟區少於它所替換的節點，則必須使用 `repair-data`腳本。



您可以還原兩種類型的物件資料：

* 假設網格的 ILM 規則已配置為使物件副本可用，則複製的資料物件將從其他位置還原。
+
** 如果 ILM 規則配置為僅儲存複製副本，且該副本存在於發生故障的儲存磁碟區上，則您將無法復原該物件。
** 如果物件的唯一剩餘副本位於雲端儲存池中，StorageGRID必須向雲端儲存池端點發出多個請求來還原物件資料。


* 透過重新組裝儲存的片段來恢復擦除編碼 (EC) 資料物件。損壞或遺失的片段由擦除編碼演算法從剩餘的資料和奇偶校驗片段中重新建立。
+
當某些儲存節點處於離線狀態時，可以開始修復擦除編碼資料。然而，如果無法解釋所有擦除編碼數據，則無法完成修復。所有節點可用後修復將完成。




NOTE: 磁碟區復原取決於儲存物件副本的資源的可用性。卷恢復的進度是非線性的，可能需要幾天或幾週才能完成。



== [[enable-auto-restore-mode]]啟用自動復原模式

啟用自動還原模式後，當磁碟區準備好還原時，磁碟區還原將自動開始。

.步驟
. 在網格管理員中前往*維護*>*磁碟區復原*。
. 選擇*要恢復的節點*選項卡，然後將*自動恢復模式*的開關滑動到啟用位置。
. 當出現確認對話方塊時，請檢查詳細資訊。
+
[NOTE]
====
** 您將無法在任何節點上手動啟動磁碟區復原作業。
** 只有當沒有其他維護程序正在進行時，磁碟區復原才會自動開始。
** 您可以從進度監控頁面監控作業的狀態。
** StorageGRID會自動重試啟動失敗的磁碟區復原。


====
. 當您了解啟用自動復原模式的結果時，請在確認對話方塊中選擇*是*。
+
您可以隨時停用自動恢復模式。





== [[manually-restore]]手動還原失敗的磁碟區或節點

請依照下列步驟恢復故障的磁碟區或節點。

.步驟
. 在網格管理員中前往*維護*>*磁碟區復原*。
. 選擇*要恢復的節點*選項卡，然後將*自動恢復模式*的開關滑動到停用位置。
+
選項卡上的數字表示需要恢復磁碟區的節點數。

. 展開每個節點以查看其中需要恢復的磁碟區及其狀態。
. 糾正任何阻礙每個卷恢復的問題。如果它顯示為磁碟區狀態，則當您選擇*等待手動步驟*時會指示問題。
. 選擇要還原的所有磁碟區均指示「準備還原」狀態的節點。
+
一次只能還原一個節點的磁碟區。

+
節點中的每個卷都必須表明它已準備好恢復。

. 選擇*開始恢復*。
. 解決可能出現的任何警告或選擇*仍然開始*以忽略警告並開始恢復。


當復原開始時，節點會從*要復原的節點*標籤移至*復原進度*標籤。

如果無法啟動磁碟區恢復，節點將返回「要恢復的節點」標籤。



== [[view-restoration-progress]]查看恢復進度

*恢復進度*標籤顯示磁碟區復原過程的狀態以及正在復原的節點的磁碟區的資訊。

所有磁碟區中複製和糾刪碼物件的資料修復率是所有正在進行的修復的平均值，包括使用 `repair-data`腳本。也標示了這些卷中完好無損且不需要修復的物體的百分比。


NOTE: 複製資料的復原取決於儲存複製副本的資源的可用性。複製資料復原的進度是非線性的，可能需要幾天或幾週才能完成。

恢復作業部分顯示從網格管理器啟動的磁碟區恢復的資訊。

* 恢復作業部分標題中的數字表示正在恢復或排隊等待恢復的捲的數量。
* 此表顯示有關正在復原的節點中每個磁碟區的資訊及其進度。
+
** 每個節點的進度顯示每個作業的百分比。
** 展開詳細資料列以顯示恢復開始時間和作業 ID。


* 如果磁碟區復原失敗：
+
** 狀態列顯示 `failed (attempting retry)`，並將自動重試。
** 如果多個復原作業失敗，則會先自動重試最近的作業。
** 如果重試繼續失敗，則會觸發*EC 修復失敗*警報。請依照警報中的步驟解決問題。






== [[view-restoration-history]]查看恢復歷史記錄

*恢復歷史*標籤顯示所有已成功完成的捲恢復的資訊。


NOTE: 大小不適用於複製的對象，並且僅出現在包含擦除編碼 (EC) 資料對象的恢復中。
