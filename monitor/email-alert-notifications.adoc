---
permalink: monitor/email-alert-notifications.html 
sidebar: sidebar 
keywords: how to disable alert rules, how to remove a custom alert rule 
summary: 如果您希望在發生警報時發送電子郵件通知，則必須提供有關 SMTP 伺服器的資訊。您還必須輸入警報通知收件人的電子郵件地址。 
---
= 設定警報的電子郵件通知
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
如果您希望在發生警報時發送電子郵件通知，則必須提供有關 SMTP 伺服器的資訊。您還必須輸入警報通知收件人的電子郵件地址。

.開始之前
* 您已使用link:../admin/web-browser-requirements.html["支援的網頁瀏覽器"]。
* 你有link:../admin/admin-group-permissions.html["管理警報或 Root 存取權限"]。


.關於此任務
用於警報通知的電子郵件設定不用於AutoSupport套件。但是，您可以對所有通知使用同一個電子郵件伺服器。

如果您的StorageGRID部署包含多個管理節點，則主管理節點是警報通知、 AutoSupport套件以及 SNMP 陷阱和通知的首選傳送者。如果主管理節點無法使用，其他管理節點會暫時發送通知。看link:../primer/what-admin-node-is.html["什麼是管理節點？"] 。

.步驟
. 選擇*警報* > *電子郵件設定*。
+
出現電子郵件設定頁面。

. 勾選「啟用電子郵件通知」複選框，表示您希望在警報達到配置的閾值時發送通知電子郵件。
+
出現電子郵件（SMTP）伺服器、傳輸層安全性（TLS）、電子郵件地址和篩選器部分。

. 在電子郵件（SMTP）伺服器部分，輸入StorageGRID存取您的 SMTP 伺服器所需的資訊。
+
如果您的 SMTP 伺服器需要身份驗證，則必須提供使用者名稱和密碼。

+
[cols="1a,2a"]
|===
| 場地 | 進入 


 a| 
郵件伺服器
 a| 
SMTP 伺服器的完全限定網域名稱 (FQDN) 或 IP 位址。



 a| 
港口
 a| 
用於存取 SMTP 伺服器的連接埠。必須介於 1 到 65535 之間。



 a| 
使用者名稱（可選）
 a| 
如果您的 SMTP 伺服器需要身份驗證，請輸入用於身份驗證的使用者名稱。



 a| 
密碼（可選）
 a| 
如果您的 SMTP 伺服器需要身份驗證，請輸入用於身份驗證的密碼。

|===
. 在電子郵件地址部分，輸入寄件者和每個收件者的電子郵件地址。
+
.. 對於*寄件者電子郵件地址*，請指定一個有效的電子郵件地址作為警報通知的寄件者地址。
+
例如：  `storagegrid-alerts@example.com`

.. 在收件者部分，輸入每個電子郵件清單或在發生警報時應接收電子郵件的人員的電子郵件地址。
+
選擇加號圖標image:../media/icon_plus_sign_black_on_white.gif["加號圖示"]新增收件人。



. 如果與 SMTP 伺服器通訊需要傳輸層安全性 (TLS)，請在傳輸層安全性 (TLS) 部分中選擇 *需要 TLS*。
+
.. 在 *CA 憑證* 欄位中，提供用於驗證 SMTP 伺服器身分的 CA 憑證。
+
您可以將內容複製並貼上到此欄位中，或選擇*瀏覽*並選擇檔案。

+
您必須提供一個包含來自每個中間頒發憑證機構 (CA) 的憑證的文件。該文件應包含每個 PEM 編碼的 CA 憑證文件，並按憑證鏈順序連接。

.. 如果您的 SMTP 電子郵件伺服器要求電子郵件寄件者提供用戶端憑證進行驗證，請勾選「*傳送用戶端憑證*」複選框。
.. 在 *用戶端憑證* 欄位中，提供 PEM 編碼的用戶端憑證以傳送至 SMTP 伺服器。
+
您可以將內容複製並貼上到此欄位中，或選擇*瀏覽*並選擇檔案。

.. 在 *私鑰* 欄位中，以未加密的 PEM 編碼輸入用戶端憑證的私鑰。
+
您可以將內容複製並貼上到此欄位中，或選擇*瀏覽*並選擇檔案。

+

NOTE: 如果您需要編輯電子郵件設置，請選擇鉛筆圖標image:../media/icon_edit_tm.png["編輯圖示"]更新此欄位。



. 在「過濾器」部分中，選擇哪些警報嚴重性等級應導致電子郵件通知，除非特定警報的規則已被靜音。
+
[cols="1a,2a"]
|===
| 嚴重程度 | 描述 


 a| 
輕微、重大、嚴重
 a| 
當滿足警報規則的次要、主要或關鍵條件時，會發送電子郵件通知。



 a| 
重大、關鍵
 a| 
當滿足警報規則的主要或關鍵條件時，會發送電子郵件通知。對於輕微警報，不會發送通知。



 a| 
僅限關鍵
 a| 
僅當滿足警報規則的關鍵條件時才會發送電子郵件通知。對於輕微或重大警報，不會發送通知。

|===
. 當您準備好測試電子郵件設定時，請執行以下步驟：
+
.. 選擇*發送測試電子郵件*。
+
出現確認訊息，表示測試電子郵件已傳送。

.. 檢查所有電子郵件收件者的收件匣並確認收到了測試電子郵件。
+

NOTE: 如果幾分鐘內沒有收到電子郵件或觸發了*電子郵件通知失敗*警報，請檢查您的設定並重試。

.. Sign in任何其他管理節點並發送測試電子郵件以驗證所有網站的連線。
+

NOTE: 測試警報通知時，您必須登入每個管理節點以驗證連線性。這與測試AutoSupport套件形成對比，在測試 AutoSupport 套件時，所有管理節點都會傳送測試電子郵件。



. 選擇*儲存*。
+
發送測試電子郵件不會儲存您的設定。您必須選擇*儲存*。

+
電子郵件設定已儲存。





== 警報電子郵件通知中包含的訊息

配置 SMTP 電子郵件伺服器後，當觸發警報時，電子郵件通知將發送給指定的收件人，除非警報規則被靜默抑制。看link:silencing-alert-notifications.html["靜音警報通知"] 。

電子郵件通知包含以下資訊：

image::../media/alerts_email_notification.png[警報電子郵件通知]

[cols="1a,6a"]
|===
| 大喊 | 描述 


 a| 
1
 a| 
警報的名稱，後面跟著此警報的活動實例數。



 a| 
2
 a| 
警報的描述。



 a| 
3
 a| 
針對警報的任何建議操作。



 a| 
4
 a| 
有關警報的每個活動實例的詳細信息，包括受影響的節點和站點、警報嚴重性、觸發警報規則的 UTC 時間以及受影響的作業和服務的名稱。



 a| 
5
 a| 
發送通知的管理節點的主機名稱。

|===


== 警報如何分組

為了防止在觸發警報時發送過多的電子郵件通知， StorageGRID嘗試將多個警報分組到同一個通知。

請參閱下表，以了解StorageGRID如何在電子郵件通知中對多個警報進行分組的範例。

[cols="1a,1a"]
|===
| 行為 | 例子 


 a| 
每個警報通知僅適用於具有相同名稱的警報。如果同時觸發兩個不同名稱的警報，則會發送兩封電子郵件通知。
 a| 
* 警報 A 同時在兩個節點上觸發。僅發送一條通知。
* 節點1上觸發Alert A，同時節點2上觸發Alert B。發送兩個通知－每個警報一個通知。




 a| 
對於特定節點上的特定警報，如果達到多個嚴重程度的閾值，則僅針對最嚴重的警報發送通知。
 a| 
* 警報 A 被觸發，並且達到輕微、嚴重和嚴重警報閾值。對於嚴重警報，將發送通知。




 a| 
第一次觸發警報時， StorageGRID會等待 2 分鐘才發送通知。如果在此期間觸發了其他同名警報， StorageGRID會將所有警報分組到初始通知中。
 a| 
. 警報 A 於 08:00 在節點 1 上觸發。未發送任何通知。
. 警報 A 於 08:01 在節點 2 上觸發。未發送任何通知。
. 08:02 時，發送通知報告兩次警報實例。




 a| 
如果觸發另一個同名警報， StorageGRID會等待 10 分鐘再發送新通知。新的通知會報告所有活動警報（尚未靜音的當前警報），即使這些警報之前已報告過。
 a| 
. 警報 A 於 08:00 在節點 1 上觸發。通知於 08:02 發送。
. 警報 A 於 08:05 在節點 2 上觸發。第二條通知於 08:15（10 分鐘後）發送。兩個節點均已報告。




 a| 
如果目前存在多個同名警報，並且其中一個警報已解決，則當該警報在已解決該警報的節點上再次發生時，不會發送新的通知。
 a| 
. 節點 1 觸發警報 A。已發送通知。
. 節點 2 觸發警報 A。已發送第二條通知。
. 警報 A 對於節點 2 已解決，但對於節點 1 仍然有效。
. 節點 2 再次觸發警報 A。由於警報對於節點 1 仍然有效，因此不會發送新通知。




 a| 
StorageGRID會每 7 天繼續發送一次電子郵件通知，直到警報的所有實例都已解決或警報規則已靜音。
 a| 
. 3 月 8 日，針對節點 1 觸發警報 A。已發送通知。
. 警報 A 尚未解決或消除。  3 月 15 日、3 月 22 日、3 月 29 日等將發送額外通知。


|===


== 排除警報電子郵件通知故障

如果觸發了「電子郵件通知失敗」警報或您無法收到測試警報電子郵件通知，請依照下列步驟解決問題。

.開始之前
* 您已使用link:../admin/web-browser-requirements.html["支援的網頁瀏覽器"]。
* 你有link:../admin/admin-group-permissions.html["管理警報或 Root 存取權限"]。


.步驟
. 驗證您的設定。
+
.. 選擇*警報* > *電子郵件設定*。
.. 驗證電子郵件（SMTP）伺服器設定是否正確。
.. 驗證您是否為收件者指定了有效的電子郵件地址。


. 檢查您的垃圾郵件過濾器，確保電子郵件沒有被發送到垃圾郵件資料夾。
. 請您的電子郵件管理員確認來自寄件者地址的電子郵件沒有被封鎖。
. 收集管理節點的日誌文件，然後聯絡技術支援。
+
技術支援可以使用日誌中的資訊來幫助確定出了什麼問題。例如，連接到您指定的伺服器時，prometheus.log 檔案可能會顯示錯誤。

+
看link:collecting-log-files-and-system-data.html["收集日誌檔案和系統數據"] 。


