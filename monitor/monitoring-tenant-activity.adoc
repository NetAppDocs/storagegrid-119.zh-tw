---
permalink: monitor/monitoring-tenant-activity.html 
sidebar: sidebar 
keywords: how to monitor tenant activity 
summary: 所有 S3 用戶端活動都與StorageGRID租用戶帳戶相關聯。您可以使用網格管理器監控所有租用戶或特定租用戶的儲存使用量或網路流量。您可以使用審計日誌或 Grafana 儀表板來收集有關租戶如何使用StorageGRID 的更多詳細資訊。 
---
= 監控租戶活動
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
所有 S3 用戶端活動都與StorageGRID租用戶帳戶相關聯。您可以使用網格管理器監控所有租用戶或特定租用戶的儲存使用量或網路流量。您可以使用審計日誌或 Grafana 儀表板來收集有關租戶如何使用StorageGRID 的更多詳細資訊。

.開始之前
* 您已使用link:../admin/web-browser-requirements.html["支援的網頁瀏覽器"]。
* 你有link:../admin/admin-group-permissions.html["根存取權限或租用戶帳戶權限"]。




== 查看所有租戶

租戶頁面顯示所有目前租戶帳戶的基本資訊。

.步驟
. 選擇*租戶*。
. 查看租戶頁面上顯示的資訊。
+
列出了每個租戶使用的邏輯空間、配額使用情況、配額和物件數量。如果沒有為租戶設定配額，則配額使用情況和配額欄位包含破折號 (&#8212;)。

+

NOTE: 所用空間值為估計值。這些估計值受到攝取時間、網路連接和節點狀態的影響。

+
image::../media/tenant_accounts_page.png[租戶帳戶頁面]

. （可選）透過選擇登入連結登入租戶帳戶image:../media/icon_tenant_sign_in.png["租戶登入圖示"]在*Sign in/複製URL*欄中。
. （可選）透過選擇複製 URL 連結複製租用戶登入頁面的 URLimage:../media/icon_tenant_copy_url.png["租戶複製 URL 圖標"]在*Sign in/複製URL*欄中。
. 或者，選擇“匯出為 CSV”來查看和匯出 `.csv`包含所有租戶的使用值的檔案。
+
系統會提示您開啟或儲存 `.csv`文件。

+
的內容 `.csv`文件如下例所示：

+
image::../media/tenant_accounts_example_csv.png[租用戶帳戶範例 .csv]

+
您可以打開 `.csv`在電子表格應用程式中儲存文件或在自動化中使用它。

. 如果沒有列出任何對象，則可以選擇「*操作*」>「*刪除*」來刪除一個或多個租戶。看link:../admin/deleting-tenant-account.html["刪除租用戶帳戶"] 。
+
如果租用戶帳戶包含任何儲存桶或容器，則您無法刪除該帳戶。





== 查看特定租戶

您可以查看特定租戶的詳細資訊。

.步驟
. 從租戶頁面中選擇租戶名稱。
+
出現租戶詳細資料頁面。

+
image::../media/tenant_usage_modal.png[租戶使用模式]

. 查看頁面頂部的租戶概覽。
+
詳細資訊頁面的此部分提供租戶的摘要信息，包括租戶的物件數、配額使用情況、已使用的邏輯空間和配額設定。

. 從*空間細分*標籤中，查看*空間消耗*圖表。
+
此圖表顯示了租戶所有 S3 儲存桶的總空間消耗量。

+
如果為此租戶設定了配額，則已使用配額量和剩餘配額量將以文字顯示（例如， `85.00 GB of 100 GB used` ）。如果沒有設定配額，則租戶擁有無限配額，且文字僅包含已使用的空間量（例如， `85.00 GB used` ）。長條圖顯示每個桶子或容器中的配額百分比。如果租戶超出儲存配額 1% 以上且至少 1 GB，則圖表會顯示總配額和超出量。

+
您可以將遊標放在長條圖上來查看每個儲存桶或容器使用的儲存空間。您可以將遊標放在可用空間部分上以查看剩餘的儲存配額量。

+
image::../media/tenant_bucket_space_consumption_GM.png[租戶儲存桶消耗長條圖]

+

CAUTION: 配額使用基於內部估計，在某些情況下可能會超出。例如，當租用戶開始上傳物件時， StorageGRID會檢查配額，如果租用戶超出配額，則會拒絕新的攝取。但是， StorageGRID在決定是否超出配額時不會考慮目前上傳的大小。如果對像被刪除，租用戶可能會暫時無法上傳新對象，直到重新計算配額使用量。配額使用情況計算可能需要 10 分鐘或更長。

+

NOTE: 租戶的配額使用情況表示租戶已上傳至StorageGRID 的物件資料總量（邏輯大小）。配額使用情況並不代表用於儲存這些物件的副本及其元資料（物理大小）的空間。

+

NOTE: 您可以啟用「租戶配額使用率高」警報規則來確定租戶是否正在消耗其配額。如果啟用，當租用戶使用了其配額的 90% 時會觸發此警報。有關說明，請參閱link:../monitor/editing-alert-rules.html["編輯警報規則"]。

. 從「空間細分」標籤中，查看「儲存桶詳細資料」。
+
此表列出了租戶的 S3 儲存桶。已用空間是儲存桶或容器中的物件資料總量。此值不代表 ILM 副本和物件元資料所需的儲存空間。

. 或者，選擇「匯出到 CSV」來檢視和匯出包含每個儲存桶或容器的使用值的 .csv 檔案。
+
單一 S3 租戶的內容 `.csv`文件如下例所示：

+
image::../media/tenant_bucket_details_csv.png[租戶儲存桶詳細資訊 CSV 範例]

+
您可以打開 `.csv`在電子表格應用程式中儲存文件或在自動化中使用它。

. 或者，選擇「*允許的功能*」標籤來查看為租用戶啟用的權限和功能的清單。看link:../admin/editing-tenant-account.html["編輯租戶帳戶"]如果您需要更改任何這些設定。
. 如果租用戶具有*使用網格聯合連接*權限，則可以選擇*網格聯合*選項卡來了解有關連接的更多資訊。
+
看link:../admin/grid-federation-overview.html["什麼是電網聯合？"]和link:../admin/grid-federation-manage-tenants.html["管理電網聯合的允許租戶"]。





== 查看網路流量

如果某位租用戶有流量分類策略，請檢查該租用戶的網路流量。

.步驟
. 選擇*配置* > *網路* > *流量分類*。
+
出現「流量分類策略」頁面，現有策略列在表格中。

. 查看政策清單以確定適用於特定租戶的政策。
. 若要查看與策略相關的指標，請選擇策略左側的單選按鈕，然後選擇*指標*。
. 分析圖表以確定策略限制流量的頻率以及是否需要調整策略。


看link:../admin/managing-traffic-classification-policies.html["管理流量分類策略"]了解更多。



== 使用審核日誌

或者，您可以使用稽核日誌來更細緻地監控租戶的活動。

例如，您可以監控以下類型的信息：

* 特定的客戶端操作，例如 PUT、GET 或 DELETE
* 物件大小
* 應用於物件的 ILM 規則
* 客戶端請求的來源IP


審計日誌寫入文字文件，您可以使用您選擇的日誌分析工具進行分析。這使您能夠更好地了解客戶活動，或實施複雜的退款和計費模型。

看link:../audit/index.html["審查審計日誌"]了解更多。



== 使用 Prometheus 指標

或者，使用 Prometheus 指標來報告租戶活動。

* 在網格管理器中，選擇 *SUPPORT* > *Tools* > *Metrics*。您可以使用現有的儀表板（例如 S3 概覽）來查看客戶活動。
+

NOTE: 指標頁面上提供的工具主要供技術支援使用。這些工具中的某些功能和選單項目故意不起作用。

* 從網格管理器的頂部，選擇幫助圖示並選擇*API 文件*。您可以使用網格管理 API 的指標部分中的指標來為租用戶活動建立自訂警報規則和儀表板。


看link:reviewing-support-metrics.html["審查支持指標"]了解更多。
